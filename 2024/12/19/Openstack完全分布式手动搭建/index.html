

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/title.jpg">
  <link rel="icon" href="/img/title.jpg">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="smile smith">
  <meta name="keywords" content="">
  
    <meta name="description" content="Openstack完全分布式手动搭建(Rocky版) 本文均采用openstack快速修改配置文件工具进行修改，强力感谢@再看我把你吃掉博主的《centos7.4安装部署openstack（rocky）》博客的帮助！！！！！！  规划   controller节点 computer节点    MariaDB数据库服务    RabbitMQ消息队列服务    Memcached缓存服务    et">
<meta property="og:type" content="article">
<meta property="og:title" content="Openstack完全分布式手动搭建(Rocky版)">
<meta property="og:url" content="https://smile-smith.github.io/2024/12/19/Openstack%E5%AE%8C%E5%85%A8%E5%88%86%E5%B8%83%E5%BC%8F%E6%89%8B%E5%8A%A8%E6%90%AD%E5%BB%BA/index.html">
<meta property="og:site_name">
<meta property="og:description" content="Openstack完全分布式手动搭建(Rocky版) 本文均采用openstack快速修改配置文件工具进行修改，强力感谢@再看我把你吃掉博主的《centos7.4安装部署openstack（rocky）》博客的帮助！！！！！！  规划   controller节点 computer节点    MariaDB数据库服务    RabbitMQ消息队列服务    Memcached缓存服务    et">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-12-19T06:03:00.000Z">
<meta property="article:modified_time" content="2024-12-19T07:15:37.374Z">
<meta property="article:author" content="smile smith">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="OpenStack">
<meta name="twitter:card" content="summary_large_image">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>Openstack完全分布式手动搭建(Rocky版) - </title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"smile-smith.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong></strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Openstack完全分布式手动搭建(Rocky版)"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        smile smith
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-12-19 14:03" pubdate>
          2024年12月19日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          11k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          95 分钟
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> 次
        </span>
        

      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Openstack完全分布式手动搭建(Rocky版)</h1>
            
              <p id="updated-time" class="note note-info" style="">
                
                  
                    本文最后更新于 2024年12月19日 下午
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <h1 id="Openstack完全分布式手动搭建-Rocky版"><a href="#Openstack完全分布式手动搭建-Rocky版" class="headerlink" title="Openstack完全分布式手动搭建(Rocky版)"></a>Openstack完全分布式手动搭建(Rocky版)</h1><hr>
<p><strong>本文均采用openstack快速修改配置文件工具进行修改，强力感谢<a target="_blank" rel="noopener" href="https://blog.csdn.net/zz_aiytag">@再看我把你吃掉</a>博主的<a target="_blank" rel="noopener" href="https://blog.csdn.net/zz_aiytag/article/details/104390440">《centos7.4安装部署openstack（rocky）》</a>博客的帮助！！！！！！</strong></p>
<hr>
<h2 id="规划"><a href="#规划" class="headerlink" title="规划"></a>规划</h2><table>
<thead>
<tr>
<th>controller节点</th>
<th>computer节点</th>
</tr>
</thead>
<tbody><tr>
<td>MariaDB数据库服务</td>
<td></td>
</tr>
<tr>
<td>RabbitMQ消息队列服务</td>
<td></td>
</tr>
<tr>
<td>Memcached缓存服务</td>
<td></td>
</tr>
<tr>
<td>etcd服务</td>
<td></td>
</tr>
<tr>
<td>keystone身份认证服务</td>
<td></td>
</tr>
<tr>
<td>httpd服务</td>
<td></td>
</tr>
<tr>
<td>glance镜像服务</td>
<td></td>
</tr>
<tr>
<td>nova计算的管理服务</td>
<td>nova计算服务</td>
</tr>
<tr>
<td>placement资源监控服务</td>
<td></td>
</tr>
<tr>
<td>neutron网络服务</td>
<td></td>
</tr>
<tr>
<td>dashboard面板服务</td>
<td></td>
</tr>
</tbody></table>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><h3 id="1-修改controller和computer的主机名"><a href="#1-修改controller和computer的主机名" class="headerlink" title="1. 修改controller和computer的主机名"></a>1. 修改controller和computer的主机名</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">修改controller的主机名</span><br>hostnamectl set-hostname controller<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">修改computer的主机名</span><br>hostnamectl set-hostname computer<br></code></pre></td></tr></table></figure>

<h3 id="2-配置hosts文件"><a href="#2-配置hosts文件" class="headerlink" title="2. 配置hosts文件"></a>2. 配置hosts文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">在controller节点上面配置hosts文件，后续通过工具同步到computer文件</span><br>cat &gt;&gt; /etc/hosts &lt;&lt; EOF<br>192.168.66.6 controller<br>192.168.66.7 computer<br>EOF<br></code></pre></td></tr></table></figure>

<h3 id="3-配置controller节点SSH免密钥登录集群"><a href="#3-配置controller节点SSH免密钥登录集群" class="headerlink" title="3. 配置controller节点SSH免密钥登录集群"></a>3. 配置controller节点SSH免密钥登录集群</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">controller节点生成SSH秘钥</span><br>ssh-keygen -t ed25519 -P &quot;&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">contorller节点传输SSH私钥到本机</span><br>ssh-copy-id root@controller<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">contorller节点传输SSH私钥到computer节点</span><br>ssh-copy-id root@computer<br></code></pre></td></tr></table></figure>

<h3 id="4-关闭Selinux和防火墙"><a href="#4-关闭Selinux和防火墙" class="headerlink" title="4. 关闭Selinux和防火墙"></a>4. 关闭Selinux和防火墙</h3><blockquote>
<p>完全关闭Selinux需要重启才会生效</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">临时关闭selinux</span><br>setenforce 0<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">controller节点永久关闭selinux</span><br>sed -i &#x27;s|SELINUX=enforcing|SELINUX=disabled|&#x27; /etc/selinux/config<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">computer节点永久关闭Selinux</span><br>ssh computer &quot;sed -i &#x27;s|SELINUX=enforcing|SELINUX=disabled|&#x27; /etc/selinux/config&quot;<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">关闭controller节点的防火墙并禁用开机自启动</span><br>systemctl stop firewalld &amp;&amp; systemctl disable firewalld<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">关闭computer节点的防火墙并禁用开机自启动</span><br>ssh computer &quot;systemctl stop firewalld &amp;&amp; systemctl disable firewalld&quot;<br></code></pre></td></tr></table></figure>

<h3 id="5-安装配置chrony时间同步服务"><a href="#5-安装配置chrony时间同步服务" class="headerlink" title="5. 安装配置chrony时间同步服务"></a>5. 安装配置chrony时间同步服务</h3><h4 id="5-1-controller节点安装时间同步服务"><a href="#5-1-controller节点安装时间同步服务" class="headerlink" title="5.1 controller节点安装时间同步服务"></a>5.1 controller节点安装时间同步服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">controller节点安装chrony服务</span><br>yum install -y chrony<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">注释原有chrony时间服务器</span><br>sed -i &quot;s|server|# server|&quot; /etc/chrony.conf <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">添加controller为时间同步服务器节点</span><br>sed -i &#x27;6a server controller iburst&#x27; /etc/chrony.conf <br><br><br></code></pre></td></tr></table></figure>

<h4 id="5-2-computer节点使用时间同步服务器"><a href="#5-2-computer节点使用时间同步服务器" class="headerlink" title="5.2 computer节点使用时间同步服务器"></a>5.2 computer节点使用时间同步服务器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">computer节点安装chrony服务</span><br>ssh computer &quot;yum install -y chrony&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">同步chrony.conf配置文件到computer节点</span><br>scp /etc/chrony.conf computer:/etc/<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">同步hosts文件到computer节点</span><br>scp /etc/hosts computer:/etc/<br></code></pre></td></tr></table></figure>

<h4 id="5-3-重启chrony服务"><a href="#5-3-重启chrony服务" class="headerlink" title="5.3 重启chrony服务"></a>5.3 重启chrony服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">controller节点重启chrony服务</span><br>systemctl restart chrony*<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">computer节点重启chrony服务</span><br>ssh computer &#x27;systemctl restart chrony*&#x27;<br></code></pre></td></tr></table></figure>

<h4 id="5-4-验证chrony服务"><a href="#5-4-验证chrony服务" class="headerlink" title="5.4 验证chrony服务"></a>5.4 验证chrony服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">controller节点验证</span><br>chronyc sources<br><span class="hljs-meta prompt_"># </span><span class="language-bash">computer节点验证</span><br>ssh computer &quot;chronyc sources&quot;<br></code></pre></td></tr></table></figure>

<h3 id="6-创建openstack的rocky版本的repo源文件"><a href="#6-创建openstack的rocky版本的repo源文件" class="headerlink" title="6. 创建openstack的rocky版本的repo源文件"></a>6. 创建openstack的rocky版本的repo源文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &gt; /etc/yum.repos.d/openstack.repo &lt;&lt; &quot;EOF&quot;<br>[openstack-rocky]<br>name=openstack-rocky<br>baseurl=https://mirrors.aliyun.com/centos/7/cloud/x86_64/openstack-rocky/<br>enabled=1<br>gpgcheck=0<br>[qume-kvm]<br>name=qemu-kvm<br>baseurl= https://mirrors.aliyun.com/centos/7/virt/x86_64/kvm-common/<br>enabled=1<br>gpgcheck=0<br>EOF<br><br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">同步repo文件到computer节点</span><br>scp /etc/yum.repos.d/openstack.repo computer:/etc/yum.repos.d/<br></code></pre></td></tr></table></figure>

<h3 id="7-重启服务器"><a href="#7-重启服务器" class="headerlink" title="7. 重启服务器"></a>7. 重启服务器</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">重启computer节点</span><br>ssh computer &quot;reboot&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">重启controller节点</span><br>reboot<br></code></pre></td></tr></table></figure>

<h2 id="正式安装搭建"><a href="#正式安装搭建" class="headerlink" title="正式安装搭建"></a>正式安装搭建</h2><h3 id="8-安装Openstack客户端软件包"><a href="#8-安装Openstack客户端软件包" class="headerlink" title="8. 安装Openstack客户端软件包"></a>8. 安装Openstack客户端软件包</h3><blockquote>
<p>controller节点和computer节点都需要进行安装</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">controller节点安装Openstack客户端release包</span><br>yum install centos-release-openstack-rocky -y<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">进入yum源配置</span><br>cd /etc/yum.repos.d/ <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">备份客户端自带的yum源</span><br>mv CentOS-OpenStack-rocky.repo CentOS-OpenStack-rocky.repo.bak<br>mv CentOS-QEMU-EV.repo CentOS-QEMU-EV.repo.bak<br>mv CentOS-Ceph-Luminous.repo CentOS-Ceph-Luminous.repo.bak<br>mv CentOS-Storage-common.repo CentOS-Storage-common.repo.bak<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">controller节点安装Openstack客户端包</span><br>yum install python-openstackclient openstack-selinux -y<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">computerr节点安装Openstack客户端release包</span><br>ssh computer &quot;yum install centos-release-openstack-rocky -y&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">备份客户端自带的yum源</span><br>ssh computer &quot;mv /etc/yum.repos.d/CentOS-OpenStack-rocky.repo /etc/yum.repos.d/CentOS-OpenStack-rocky.repo.bak&quot;<br>ssh computer &quot;mv /etc/yum.repos.d/CentOS-QEMU-EV.repo /etc/yum.repos.d/CentOS-QEMU-EV.repo.bak&quot;<br>ssh computer &quot;mv /etc/yum.repos.d/CentOS-Ceph-Luminous.repo /etc/yum.repos.d/CentOS-Ceph-Luminous.repo.bak&quot;<br>ssh computer &quot;mv /etc/yum.repos.d/CentOS-Storage-common.repo /etc/yum.repos.d/CentOS-Storage-common.repo.bak&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">computer节点安装Openstack客户端包</span><br>ssh computer &quot;yum install python-openstackclient openstack-selinux -y&quot;<br></code></pre></td></tr></table></figure>

<h3 id="9-安装配置mariadb数据库-仅在controller节点"><a href="#9-安装配置mariadb数据库-仅在controller节点" class="headerlink" title="9. 安装配置mariadb数据库(仅在controller节点)"></a>9. 安装配置mariadb数据库(仅在controller节点)</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">安装Mariadb数据库</span><br>yum install mariadb mariadb-server python2-PyMySQL -y<br></code></pre></td></tr></table></figure>

<h4 id="9-1-配置数据库"><a href="#9-1-配置数据库" class="headerlink" title="9.1 配置数据库"></a>9.1 配置数据库</h4><blockquote>
<p>下方的IP地址，需要根据自己的配置修改，可以修改为0.0.0.0任意地址</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &gt;&gt; /etc/my.cnf.d/openstack.cnf &lt;&lt; &quot;EOF&quot;<br>[mysqld]<br>bind-address = 192.168.66.6<br>default-storage-engine = innodb<br>innodb_file_per_table = on<br>max_connections = 4096<br>collation-server = utf8_general_ci<br>character-set-server = utf8<br>EOF<br><br><br></code></pre></td></tr></table></figure>

<h4 id="9-2-启动数据库"><a href="#9-2-启动数据库" class="headerlink" title="9.2 启动数据库"></a>9.2 启动数据库</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">启动数据库</span><br>systemctl start mariadb<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">查看数据库状态</span><br>systemctl status mariadb<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">让数据库开机自启动</span><br>systemctl enable mariadb<br></code></pre></td></tr></table></figure>

<h4 id="9-3-加固数据库以及设置数据库超级管理员密码"><a href="#9-3-加固数据库以及设置数据库超级管理员密码" class="headerlink" title="9.3 加固数据库以及设置数据库超级管理员密码"></a>9.3 加固数据库以及设置数据库超级管理员密码</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">进行数据库加固操作</span><br>mysql_secure_installation<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs shell">----------------------------------------------<br>                   说明<br><br>NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB<br>      SERVERS IN PRODUCTION USE!  PLEASE READ EACH STEP CAREFULLY!<br>......<br><span class="hljs-meta prompt_"># </span><span class="language-bash">表示是否为数据库的root账户设置密码</span><br>Enter current password for root (enter for none):  #直接回车<br>OK, successfully used password, moving on...<br>......<br><span class="hljs-meta prompt_"># </span><span class="language-bash">是否设置root密码</span><br>Set root password? [Y/n] y<br>New password:   #输入新密码 123456<br>Re-enter new password:  #再次输入密码<br>Password updated successfully!<br>Reloading privilege tables..<br> ... Success!<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">以下几项交互根据实际情况设置</span><br>......<br><span class="hljs-meta prompt_"># </span><span class="language-bash">是否移除匿名用户</span><br>Remove anonymous users? [Y/n] y   <br>......<br><span class="hljs-meta prompt_"># </span><span class="language-bash">是否禁止数据库的root账户远程登录</span><br>Disallow root login remotely? [Y/n] n<br>......<br><span class="hljs-meta prompt_"># </span><span class="language-bash">是否移除<span class="hljs-built_in">test</span>数据库并访问它</span><br>Remove test database and access to it? [Y/n] y<br>......<br><span class="hljs-meta prompt_"># </span><span class="language-bash">是否现在重载权限表</span><br>Reload privilege tables now? [Y/n] y<br>......<br>All done!  If you&#x27;ve completed all of the above steps, your MariaDB<br>installation should now be secure.<br><br>Thanks for using MariaDB!<br><br>--------------------------------------------------------------<br></code></pre></td></tr></table></figure>

<h4 id="9-4-测试数据库"><a href="#9-4-测试数据库" class="headerlink" title="9.4 测试数据库"></a>9.4 测试数据库</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">使用root用户和密码进行登录</span><br>mysql -u root -p<br><br><br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">若连接成功，则会输出以下内容</span><br>Welcome to the MariaDB monitor.  Commands end with ; or \g.<br>Your MariaDB connection id is 9<br>Server version: 10.1.20-MariaDB MariaDB Server<br><br>Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.<br><br>Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.<br><br>MariaDB [(none)]&gt;<br></code></pre></td></tr></table></figure>

<h3 id="10-安装配置消息队列服务-仅在controller节点"><a href="#10-安装配置消息队列服务-仅在controller节点" class="headerlink" title="10. 安装配置消息队列服务(仅在controller节点)"></a>10. 安装配置消息队列服务(仅在controller节点)</h3><h4 id="10-1-安装rabbitmq服务"><a href="#10-1-安装rabbitmq服务" class="headerlink" title="10.1 安装rabbitmq服务"></a>10.1 安装rabbitmq服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">controller节点安装Rabbitmq服务</span><br>yum install rabbitmq-server -y<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">启动Rabbitmq-server服务</span><br>systemctl start rabbitmq-server<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">查看Rabbitmq-server服务状态</span><br>systemctl status rabbitmq-server<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">让Rabbitmq-server服务开机自启动</span><br>systemctl enable rabbitmq-server<br></code></pre></td></tr></table></figure>

<h4 id="10-2-配置rabbitmq服务"><a href="#10-2-配置rabbitmq服务" class="headerlink" title="10.2 配置rabbitmq服务"></a>10.2 配置rabbitmq服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">添加rabbitmq的访问用户“openstack”</span><br>rabbitmqctl add_user openstack 123456<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">授予用户<span class="hljs-string">&quot;openstack&quot;</span>访问权限</span><br>rabbitmqctl set_permissions openstack &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;<br></code></pre></td></tr></table></figure>

<h4 id="10-3-启动rabbitmq服务"><a href="#10-3-启动rabbitmq服务" class="headerlink" title="10.3 启动rabbitmq服务"></a>10.3 启动rabbitmq服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">列出Rabbitmq的插件列表</span><br>rabbitmq-plugins list<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">启动Rabbitmq的插件并开启Rabbitmq管理服务</span><br>rabbitmq-plugins enable rabbitmq_management<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">重启rabbitmq服务</span><br>systemctl restart rabbitmq-server.service<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">列出Rabbitmq的已经开启的插件列表</span><br>rabbitmq-plugins list<br><br></code></pre></td></tr></table></figure>

<h4 id="10-4-测试rabbitmq服务"><a href="#10-4-测试rabbitmq服务" class="headerlink" title="10.4 测试rabbitmq服务"></a>10.4 测试rabbitmq服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">浏览器访问http://controller节点的IP:15672<br><br>默认管理员账户：guest<br>默认管理员密码：guest<br></code></pre></td></tr></table></figure>

<h3 id="11-安装配置memcached缓存服务-仅在controller节点"><a href="#11-安装配置memcached缓存服务-仅在controller节点" class="headerlink" title="11. 安装配置memcached缓存服务(仅在controller节点)"></a>11. 安装配置memcached缓存服务(仅在controller节点)</h3><h4 id="11-1-安装Memcached服务"><a href="#11-1-安装Memcached服务" class="headerlink" title="11.1 安装Memcached服务"></a>11.1 安装Memcached服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">ctronller节点安装Memcached服务</span><br>yum install memcached python-memcached -y<br></code></pre></td></tr></table></figure>

<h4 id="11-2-配置Memcached服务"><a href="#11-2-配置Memcached服务" class="headerlink" title="11.2 配置Memcached服务"></a>11.2 配置Memcached服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">添加controller节点的主机名让其可以访问</span><br>sed -i &quot;s|127.0.0.1,::1|127.0.1,::1,controller|&quot; /etc/sysconfig/memcached<br></code></pre></td></tr></table></figure>

<h4 id="11-3-重启Memcached服务"><a href="#11-3-重启Memcached服务" class="headerlink" title="11.3 重启Memcached服务"></a>11.3 重启Memcached服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">重启Memcached服务</span><br>systemctl restart memcached <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">让memcached服务开机自启动</span><br>systemctl enable memcached<br></code></pre></td></tr></table></figure>

<h3 id="12-安装配置etcd服务-仅在controller节点"><a href="#12-安装配置etcd服务-仅在controller节点" class="headerlink" title="12. 安装配置etcd服务(仅在controller节点)"></a>12. 安装配置etcd服务(仅在controller节点)</h3><h4 id="12-1-安装etcd服务"><a href="#12-1-安装etcd服务" class="headerlink" title="12.1 安装etcd服务"></a>12.1 安装etcd服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">controller节点安装etcd服务</span><br>yum install etcd -y <br></code></pre></td></tr></table></figure>

<h4 id="12-2-配置etcd服务"><a href="#12-2-配置etcd服务" class="headerlink" title="12.2 配置etcd服务"></a>12.2 配置etcd服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">修改该etcd服务的节点名称，便于其他节点识别</span><br>sed -i &#x27;9s|default|controller|&#x27; /etc/etcd/etcd.conf<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">删除etcd监听对等节点的URL的注释</span><br>sed -i &#x27;5s|#||&#x27; /etc/etcd/etcd.conf<br><span class="hljs-meta prompt_"># </span><span class="language-bash">删除etcd内部通信URL的注释</span><br>sed -i &#x27;20s|#||&#x27; /etc/etcd/etcd.conf<br><span class="hljs-meta prompt_"># </span><span class="language-bash">删除etcd初始化集群URL的注释</span><br>sed -i &#x27;26s|#||&#x27; /etc/etcd/etcd.conf<br><span class="hljs-meta prompt_"># </span><span class="language-bash">删除etcd初始化集群token的注释</span><br>sed -i &#x27;27s|#||&#x27; /etc/etcd/etcd.conf<br><span class="hljs-meta prompt_"># </span><span class="language-bash">删除etcd初始化集群状态的注释</span><br>sed -i &#x27;28s|#||&#x27; /etc/etcd/etcd.conf<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">将etcd配置文件中所有本地地址替换为任意地址</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">也可以替换为IP地址</span><br>sed -i &#x27;s|localhost|0.0.0.0|&#x27; /etc/etcd/etcd.conf<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">修改该etcd初始化集群的节点名称</span><br>sed -i &#x27;26s|default|controller|&#x27; /etc/etcd/etcd.conf<br></code></pre></td></tr></table></figure>

<h4 id="12-3-启动etcd服务"><a href="#12-3-启动etcd服务" class="headerlink" title="12.3 启动etcd服务"></a>12.3 启动etcd服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">重启etcd服务</span><br>systemctl restart etcd<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">查看etcd服务的状态</span><br>systemctl status etcd<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">让etcd服务开机自启动</span><br>systemctl enable etcd<br></code></pre></td></tr></table></figure>

<h3 id="13-安装配置keystone认证服务-仅在controller"><a href="#13-安装配置keystone认证服务-仅在controller" class="headerlink" title="13. 安装配置keystone认证服务(仅在controller)"></a>13. 安装配置keystone认证服务(仅在controller)</h3><h4 id="13-1-创建keystone数据库"><a href="#13-1-创建keystone数据库" class="headerlink" title="13.1 创建keystone数据库"></a>13.1 创建keystone数据库</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">进入数据库</span><br>mysql -u root -p<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql"># 创建keystone数据库<br><span class="hljs-keyword">CREATE</span> DATABASE keystone;<br><br># 创建keystone用户并赋予“<span class="hljs-number">123456</span>”密码给该用户<br># 最后赋予keystone数据库的所有权限给该用户<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> keystone.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;keystone&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br><br># 给keystone用户远程操作keystone数据库的权限<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> keystone.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;keystone&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br><br># keystone用户使用“mysql_native_password”认证插件进行认证<br><span class="hljs-keyword">UPDATE</span> mysql.user <span class="hljs-keyword">SET</span> authentication_string <span class="hljs-operator">=</span> PASSWORD(<span class="hljs-string">&#x27;123456&#x27;</span>), plugin <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;mysql_native_password&#x27;</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">User</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;keystone&#x27;</span> <span class="hljs-keyword">AND</span> Host <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;%&#x27;</span>;<br><br># 刷新权限<br>flush privileges;<br></code></pre></td></tr></table></figure>

<h4 id="13-2-安装keystone"><a href="#13-2-安装keystone" class="headerlink" title="13.2 安装keystone"></a>13.2 安装keystone</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">安装快速修改配置文件工具</span><br>yum install openstack-utils -y<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">安装keystone工具包以及httpd服务</span><br>yum install openstack-keystone httpd mod_wsgi -y<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">如果安装出现依赖关系错误，根据报错信息，以如下命令，安装指定安装包的依赖</span><br>yum install qpid-proton-c-0.22.0-1.el7.x86_64 -y <br></code></pre></td></tr></table></figure>

<h4 id="13-3-配置keystone服务"><a href="#13-3-配置keystone服务" class="headerlink" title="13.3 配置keystone服务"></a>13.3 配置keystone服务</h4><blockquote>
<p>这里的内容需要根据自己配置进行更改</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">修改keystone的mysql数据库连接用户名以及密码</span><br>openstack-config --set /etc/keystone/keystone.conf database connection mysql+pymysql://keystone:123456@controller/keystone<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置Keystone使用“Fernet”令牌来管理身份验证令牌</span><br>openstack-config --set /etc/keystone/keystone.conf token provider fernet<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">查看修改内容</span><br>grep &quot;^[a-z]&quot; /etc/keystone/keystone.conf <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">查看keystone配置文件中，每个具体的数据项的配置</span><br>egrep -v &quot;^#|^$&quot; /etc/keystone/keystone.conf <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">同步数据库</span><br>su -s /bin/sh -c &quot;keystone-manage db_sync&quot; keystone<br></code></pre></td></tr></table></figure>

<h4 id="13-4-验证数据库同步结果"><a href="#13-4-验证数据库同步结果" class="headerlink" title="13.4 验证数据库同步结果"></a>13.4 验证数据库同步结果</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"># 选择keystone数据库<br>use keystone;<br><br># 查看keystone数据库中的表。此时若同步成功，则会有<span class="hljs-number">44</span>张表<br><span class="hljs-keyword">show</span> tables;<br></code></pre></td></tr></table></figure>

<h4 id="13-5-初始化Fernet-Key库"><a href="#13-5-初始化Fernet-Key库" class="headerlink" title="13.5 初始化Fernet Key库"></a>13.5 初始化Fernet Key库</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">配置Keystone服务的管理员是keystone用户，并且该用户属于keystone组</span><br>keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置keystone服务凭证的管理员是keystone，并且该用户属于keystone组</span><br>keystone-manage credential_setup --keystone-user keystone --keystone-group keystone<br><br><br></code></pre></td></tr></table></figure>

<h4 id="13-6-创建认证实体服务"><a href="#13-6-创建认证实体服务" class="headerlink" title="13.6 创建认证实体服务"></a>13.6 创建认证实体服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">配置Keystone服务中认证实体的密码（此密码可以与之前的密码不同）</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置认证实体管理员的URL、内部通信URL、外部通信URL以及区域ID</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">【上述URL中的controller需要替换成你自己的主机名】</span><br><br>keystone-manage bootstrap --bootstrap-password kst123456 \<br>--bootstrap-admin-url http://controller:5000/v3/ \<br>--bootstrap-internal-url http://controller:5000/v3/ \<br>--bootstrap-public-url http://controller:5000/v3/ \<br>--bootstrap-region-id RegionOne<br></code></pre></td></tr></table></figure>

<h4 id="13-7-配置httpd服务"><a href="#13-7-配置httpd服务" class="headerlink" title="13.7 配置httpd服务"></a>13.7 配置httpd服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">配置httpd服务的”服务名“（需要与主机名一致）</span><br>sed -i &#x27;95s|#ServerName www.example.com:80|ServerName controller|&#x27; /etc/httpd/conf/httpd.conf<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">检查配置</span><br>cat /etc/httpd/conf/httpd.conf |grep ServerName<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">建立文件链接,将<span class="hljs-string">&quot;Keystone&quot;</span>的配置文件链接到<span class="hljs-string">&quot;Apache&quot;</span>的配置目录</span><br>ln -s /usr/share/keystone/wsgi-keystone.conf /etc/httpd/conf.d/<br><br></code></pre></td></tr></table></figure>

<h4 id="13-8-启动httpd服务"><a href="#13-8-启动httpd服务" class="headerlink" title="13.8 启动httpd服务"></a>13.8 启动httpd服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">重启httpd服务</span><br>systemctl restart httpd<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">查看httpd服务状态</span><br>systemctl status httpd<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">使httpd服务开机自启动</span><br>systemctl enable httpd<br></code></pre></td></tr></table></figure>

<h4 id="13-9-手动引入keystone服务的用户环境变量并创建对应服务"><a href="#13-9-手动引入keystone服务的用户环境变量并创建对应服务" class="headerlink" title="13.9 手动引入keystone服务的用户环境变量并创建对应服务"></a>13.9 手动引入keystone服务的用户环境变量并创建对应服务</h4><h5 id="13-9-1-手动引入keystone服务的用户环境变量"><a href="#13-9-1-手动引入keystone服务的用户环境变量" class="headerlink" title="13.9.1 手动引入keystone服务的用户环境变量"></a>13.9.1 手动引入keystone服务的用户环境变量</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">配置keystone服务的管理员用户</span><br>export OS_USERNAME=admin<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置keystone服务的管理员密码【即“创建认证实体服务”中设置的密码】</span><br>export OS_PASSWORD=kst123456 <br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置keystone服务的管理员项目名</span><br>export OS_PROJECT_NAME=admin<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置keystone服务的默认用户域</span><br>export OS_USER_DOMAIN_NAME=Default<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置keystone服务的默认管理员项目域</span><br>export OS_PROJECT_DOMAIN_NAME=Default<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置keystone服务的管理员认证URL【即“创建认证实体服务”中设置的外部URL】</span><br>export OS_AUTH_URL=http://controller:5000/v3<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置keystone服务的身份认证API的版本</span><br>export OS_IDENTITY_API_VERSION=3<br><br><br></code></pre></td></tr></table></figure>

<h5 id="13-9-2-查看初始keystone数据库的project表内容"><a href="#13-9-2-查看初始keystone数据库的project表内容" class="headerlink" title="13.9.2 查看初始keystone数据库的project表内容"></a>13.9.2 查看初始keystone数据库的project表内容</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"># 首先进入数据库<br>mysql <span class="hljs-operator">-</span>u root <span class="hljs-operator">-</span>p<br><br># 切换到keystone数据库<br>use keystone;<br><br># 查看keystone数据库中project表的内容【这时候应该有<span class="hljs-number">3</span>行数据，没有则“创建认证实体服务”出错】<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> project;<br><br># 退出数据库<br>exit<br></code></pre></td></tr></table></figure>

<h5 id="13-9-3-创建实例以及项目"><a href="#13-9-3-创建实例以及项目" class="headerlink" title="13.9.3 创建实例以及项目"></a>13.9.3 创建实例以及项目</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">创建openstack默认实例【example项目】，实例描述为【An Example Domain】</span><br>openstack domain create --description &quot;An Example Domain&quot; example<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">在project表中，创建一个名为【service】的项目，项目描述为【Service Project】，项目默认域为【default】</span><br>openstack project create --domain default --description &quot;Service Project&quot; service<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">在project表中，创建一个名为【myproject】的项目，项目描述为【Demo Project】，项目默认域为【default】</span><br>openstack project create --domain default --description &quot;Demo Project&quot; myproject<br></code></pre></td></tr></table></figure>

<h5 id="13-9-4-验证实例和项目是否创建成功"><a href="#13-9-4-验证实例和项目是否创建成功" class="headerlink" title="13.9.4 验证实例和项目是否创建成功"></a>13.9.4 验证实例和项目是否创建成功</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"># 进入数据库查看数据<br>mysql <span class="hljs-operator">-</span>u root <span class="hljs-operator">-</span>p<br><br># 切换到keystone数据库<br>use keystone;<br><br># 查看keystone数据库中project表的内容【这时候应该有<span class="hljs-number">6</span>行数据，没有则“创建实例和项目”出错】<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> project;<br><br><br></code></pre></td></tr></table></figure>

<h5 id="13-9-5-查看初始用户表和角色表的内容"><a href="#13-9-5-查看初始用户表和角色表的内容" class="headerlink" title="13.9.5 查看初始用户表和角色表的内容"></a>13.9.5 查看初始用户表和角色表的内容</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"># 查看local_user表的初始内容【这时应该有<span class="hljs-number">1</span>行数据，没有则“同步数据库”失败】<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> local_user;<br><br># 查看role表的初始内容【这时应该有<span class="hljs-number">3</span>行数据，没有则“同步数据库”失败】<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> role;<br><br># 退出数据库<br>exit<br></code></pre></td></tr></table></figure>

<h5 id="13-9-6-创建用户以及角色"><a href="#13-9-6-创建用户以及角色" class="headerlink" title="13.9.6 创建用户以及角色"></a>13.9.6 创建用户以及角色</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">在local_user表中，创建一个用户名为【myuser】，用户默认域为【default】，这里是交互式输入密码</span><br>openstack user create --domain default  --password-prompt myuser<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">在role表中，创建一个名为【myrole】的角色</span><br>openstack role create myrole<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">将【myrole】角色添加到【myuser】用户组中，并属于【myproject】项目</span><br>openstack role add --project myproject --user myuser myrole<br></code></pre></td></tr></table></figure>

<h5 id="13-9-7-验证用户以及角色是否创建成功"><a href="#13-9-7-验证用户以及角色是否创建成功" class="headerlink" title="13.9.7 验证用户以及角色是否创建成功"></a>13.9.7 验证用户以及角色是否创建成功</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql"># 登录数据库<br>mysql <span class="hljs-operator">-</span>u root <span class="hljs-operator">-</span>p<br><br># 切换到keystone数据库<br>use keystone;<br><br># 查看local_user表的初始内容【这时应该有<span class="hljs-number">2</span>行数据，没有则“创建用户”失败】<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> local_user;<br><br># 查看role表的初始内容【这时应该有<span class="hljs-number">4</span>行数据，没有则“创建角色”失败】<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> role;<br><br># 退出数据库<br>exit<br></code></pre></td></tr></table></figure>

<h4 id="13-10-获取认证token"><a href="#13-10-获取认证token" class="headerlink" title="13.10 获取认证token"></a>13.10 获取认证token</h4><blockquote>
<p>以下的URL是指在“创建认证实体服务”中的“外部通信URL”</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">去除环境变量</span><br>unset OS_AUTH_URL OS_PASSWORD<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">管理员用户获取认证token</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">管理员密码，是在“创建认证实体服务”中的“认证实体密码”</span><br>openstack --os-auth-url http://controller:5000/v3 \<br>--os-project-domain-name Default \<br>--os-user-domain-name Default \<br>--os-project-name admin \<br>--os-username admin token issue<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">普通用户myuser获取认证toekn</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">普通用户密码，是在“创建用户以及角色”时指定的</span><br>openstack --os-auth-url http://controller:5000/v3 \<br>--os-project-domain-name Default \<br>--os-user-domain-name Default \<br>--os-project-name myproject \<br>--os-username myuser token issue<br></code></pre></td></tr></table></figure>

<h4 id="13-11-使用openstack客户端环境脚本"><a href="#13-11-使用openstack客户端环境脚本" class="headerlink" title="13.11 使用openstack客户端环境脚本"></a>13.11 使用openstack客户端环境脚本</h4><ul>
<li>这样可以简化操作，不用每次都获取认证token</li>
</ul>
<blockquote>
<p>该脚本的位置和名称没有要求，只需要便于自己记忆即可；为了方便，这里统一放在<code>/opt</code>这个目录下</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">添加管理员admin的openstack客户端环境脚本</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">根据自己的配置进行更改，随后复制粘贴即可</span><br><br>cat &gt; /opt/adminrc-openstack &lt;&lt; &quot;EOF&quot;<br>export OS_PROJECT_DOMAIN_NAME=Default<br>export OS_USER_DOMAIN_NAME=Default<br>export OS_PROJECT_NAME=admin<br>export OS_USERNAME=admin<br>export OS_PASSWORD=kst123456<br>export OS_AUTH_URL=http://controller:5000/v3<br>export OS_IDENTITY_API_VERSION=3<br>export OS_IMAGE_API_VERSION=2<br>EOF<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">添加普通用户myuser的openstack客户端环境脚本</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">根据自己的配置进行更改，随后复制粘贴即可</span><br><br>cat &gt; /opt/myuser-openstack &lt;&lt; &quot;EOF&quot;<br>export OS_PROJECT_DOMAIN_NAME=Default<br>export OS_USER_DOMAIN_NAME=Default<br>export OS_PROJECT_NAME=myproject<br>export OS_USERNAME=myuser<br>export OS_PASSWORD=123456<br>export OS_AUTH_URL=http://controller:5000/v3<br>export OS_IDENTITY_API_VERSION=3<br>export OS_IMAGE_API_VERSION=2<br>EOF<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">使用管理员环境脚本</span><br>source /opt/adminrc-openstack<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">验证脚本是否生效【列出当前用户列表】</span><br>openstack user list<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">使用普通用户环境脚本</span><br>source /opt/myuser-openstack<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">验证脚本是否生效【查看当前用户的“token”】</span><br>openstack token issue<br></code></pre></td></tr></table></figure>

<h3 id="14-安装配置glance镜像服务-仅在controller节点"><a href="#14-安装配置glance镜像服务-仅在controller节点" class="headerlink" title="14. 安装配置glance镜像服务(仅在controller节点)"></a>14. 安装配置glance镜像服务(仅在controller节点)</h3><h4 id="14-1-创建glance数据库"><a href="#14-1-创建glance数据库" class="headerlink" title="14.1 创建glance数据库"></a>14.1 创建glance数据库</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">进入数据库</span><br>mysql -u root -p<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql"># 创建glance数据库<br><span class="hljs-keyword">CREATE</span> DATABASE glance;<br><br># 创建glance用户并赋予“<span class="hljs-number">123456</span>”密码给该用户<br># 最后赋予glance数据库的所有权限给该用户<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> glance.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;glance&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br><br># 给glance用户远程操作glance数据库的权限<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> glance.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;glance&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br><br># glance用户使用“mysql_native_password”认证插件进行认证<br><span class="hljs-keyword">UPDATE</span> mysql.user <span class="hljs-keyword">SET</span> authentication_string <span class="hljs-operator">=</span> PASSWORD(<span class="hljs-string">&#x27;123456&#x27;</span>), plugin <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;mysql_native_password&#x27;</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">User</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;glance&#x27;</span> <span class="hljs-keyword">AND</span> Host <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;%&#x27;</span>;<br><br># 刷新权限<br>flush privileges;<br><br># 退出数据库<br>exit<br></code></pre></td></tr></table></figure>

<h4 id="14-2-在keystone上注册glance服务"><a href="#14-2-在keystone上注册glance服务" class="headerlink" title="14.2 在keystone上注册glance服务"></a>14.2 在keystone上注册glance服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">切换为keystone管理员的系统环境</span><br>source /opt/adminrc-openstack<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">在local_user表中，创建一个用户名为【glance】，用户默认域为【default】，这里是交互式输入密码</span><br>openstack user create --domain default --password-prompt glance<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">将【glance】用户添加到【service】项目的【admin】角色组</span><br>openstack role add --project service --user glance admin<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">创建服务实体名为【glance】，实体描述为【OpenStack Image】，服务实体类型为【image】</span><br>openstack service create --name glance --description &quot;OpenStack Image&quot; image<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">验证glance服务实体是否创建成功【列出当前用户列表】</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">目前应该有2行数据，分别是keystone和glance的数据，若没有，重新进行操作</span><br>openstack service list<br></code></pre></td></tr></table></figure>

<h4 id="14-3-在keystone上创建glance服务的API端点"><a href="#14-3-在keystone上创建glance服务的API端点" class="headerlink" title="14.3 在keystone上创建glance服务的API端点"></a>14.3 在keystone上创建glance服务的API端点</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">创建外部通信的URL端点</span><br>openstack endpoint create --region RegionOne image public http://controller:9292<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">创建内部通信的URL端点</span><br>openstack endpoint create --region RegionOne image internal http://controller:9292<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">创建管理员通信的URL端点</span><br>openstack endpoint create --region RegionOne image admin http://controller:9292<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">列出创建的端点列表</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">这是应该有6行数据，3条属于keystone服务的端点，另外3条属于glance服务的端点</span><br>openstack endpoint list<br></code></pre></td></tr></table></figure>

<h4 id="14-4-安装glance镜像服务"><a href="#14-4-安装glance镜像服务" class="headerlink" title="14.4 安装glance镜像服务"></a>14.4 安装glance镜像服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum install openstack-glance -y <br></code></pre></td></tr></table></figure>

<h4 id="14-5-配置glance的api文件"><a href="#14-5-配置glance的api文件" class="headerlink" title="14.5 配置glance的api文件"></a>14.5 配置glance的api文件</h4><blockquote>
<p>这里的内容需要根据自己配置进行更改</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">修改glance服务的mysql数据库连接用户名以及密码</span><br>openstack-config --set  /etc/glance/glance-api.conf database connection  mysql+pymysql://glance:123456@controller/glance<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置glance服务在keystone的身份验证端点URI</span><br>openstack-config --set  /etc/glance/glance-api.conf keystone_authtoken www_authenticate_uri http://controller:5000<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置glance服务在Keystone的身份验证服务的实际 URL</span><br>openstack-config --set  /etc/glance/glance-api.conf keystone_authtoken auth_url http://controller:5000<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置glance服务使用memcached作为 Keystone 身份验证服务的缓存后端</span><br>openstack-config --set  /etc/glance/glance-api.conf keystone_authtoken memcached_servers  controller:11211<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置glance服务在keystone身份认证服务使用的认证类型为密码</span><br>openstack-config --set  /etc/glance/glance-api.conf keystone_authtoken auth_type password<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置glance服务在keystone服务里的项目默认域</span><br>openstack-config --set  /etc/glance/glance-api.conf keystone_authtoken project_domain_name Default<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置glance服务在keystone服务里的用户默认域</span><br>openstack-config --set  /etc/glance/glance-api.conf keystone_authtoken user_domain_name Default<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置glance服务在keystone服务里属于service项目</span><br>openstack-config --set  /etc/glance/glance-api.conf keystone_authtoken project_name service <br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置glance服务在keystone服务里的默认用户为glance</span><br>openstack-config --set  /etc/glance/glance-api.conf keystone_authtoken username glance<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置glance服务在keystone服务里默认用户glance的默认密码为<span class="hljs-string">&quot;123456&quot;</span></span><br>openstack-config --set  /etc/glance/glance-api.conf keystone_authtoken password 123456<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置glance服务与Keystone身份验证服务能够集成</span><br>openstack-config --set  /etc/glance/glance-api.conf paste_deploy flavor keystone<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置glance服务能够使用的存储后端【本地文件系统和http】</span><br>openstack-config --set  /etc/glance/glance-api.conf glance_store stores  file,http<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置glance服务的默认存储后端为【本地文件系统】</span><br>openstack-config --set  /etc/glance/glance-api.conf glance_store default_store file<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置glance服务的默认文件系统存储位置在<span class="hljs-string">&quot;/var/lib/glance/images&quot;</span></span><br>openstack-config --set  /etc/glance/glance-api.conf glance_store filesystem_store_datadir /var/lib/glance/images/<br><br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">查看修改内容</span><br>grep &#x27;^[a-z]&#x27; /etc/glance/glance-api.conf<br></code></pre></td></tr></table></figure>

<h4 id="14-6-配置glance的注册文件"><a href="#14-6-配置glance的注册文件" class="headerlink" title="14.6 配置glance的注册文件"></a>14.6 配置glance的注册文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">配置glance服务连接mysql数据库的用户名以及密码</span><br>openstack-config --set  /etc/glance/glance-registry.conf database connection mysql+pymysql://glance:123456@controller/glance<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置glance服务在keystone的身份验证端点URI</span><br>openstack-config --set  /etc/glance/glance-registry.conf keystone_authtoken www_authenticate_uri http://controller:5000<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置glance服务在Keystone的身份验证服务的实际 URL</span><br>openstack-config --set  /etc/glance/glance-registry.conf keystone_authtoken auth_url http://controller:5000<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置glance服务使用memcached作为 Keystone 身份验证服务的缓存后端</span><br>openstack-config --set  /etc/glance/glance-registry.conf keystone_authtoken memcached_servers controller:11211<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置glance服务在keystone身份认证服务使用的认证类型为密码</span><br>openstack-config --set  /etc/glance/glance-registry.conf keystone_authtoken auth_type password<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置glance服务在keystone服务里的项目默认域</span><br>openstack-config --set  /etc/glance/glance-registry.conf keystone_authtoken project_domain_name Default<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置glance服务在keystone服务里的用户默认域</span><br>openstack-config --set  /etc/glance/glance-registry.conf keystone_authtoken user_domain_name Default<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置glance服务在keystone服务里属于service项目</span><br>openstack-config --set  /etc/glance/glance-registry.conf keystone_authtoken project_name service<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置glance服务在keystone服务里的默认用户为glance</span><br>openstack-config --set  /etc/glance/glance-registry.conf keystone_authtoken username glance<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置glance服务在keystone服务里默认用户glance的默认密码为<span class="hljs-string">&quot;123456&quot;</span></span><br>openstack-config --set  /etc/glance/glance-registry.conf keystone_authtoken password 123456<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置glance服务与Keystone身份验证服务能够集成</span><br>openstack-config --set  /etc/glance/glance-registry.conf paste_deploy flavor keystone<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">查看修改内容</span><br>grep &#x27;^[a-z]&#x27; /etc/glance/glance-registry.conf<br></code></pre></td></tr></table></figure>

<h4 id="14-7-同步数据库"><a href="#14-7-同步数据库" class="headerlink" title="14.7 同步数据库"></a>14.7 同步数据库</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">同步glance服务的数据到数据库</span><br>su -s /bin/sh -c &quot;glance-manage db_sync&quot; glance<br></code></pre></td></tr></table></figure>

<h4 id="14-8-查看数据库"><a href="#14-8-查看数据库" class="headerlink" title="14.8 查看数据库"></a>14.8 查看数据库</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">登录数据库</span><br>mysql -u root -p<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"># 切换glance数据库<br>use glance;<br><br># 查看glance数据库中的表<br># 此时应该有<span class="hljs-number">15</span>行的数据，若没有，则同步数据库失败，需要重新查看配置再执行<br><span class="hljs-keyword">show</span> tables;<br><br># 退出数据库<br>exit<br></code></pre></td></tr></table></figure>

<h4 id="14-9-启动glance服务"><a href="#14-9-启动glance服务" class="headerlink" title="14.9 启动glance服务"></a>14.9 启动glance服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">启动glance的api服务以及glance的注册机服务</span><br>systemctl start openstack-glance-api openstack-glance-registry<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">查看两项服务的状态</span><br>systemctl status openstack-glance-api openstack-glance-registry<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">让两项服务开机自启动</span><br>systemctl enable openstack-glance-api openstack-glance-registry<br></code></pre></td></tr></table></figure>

<h4 id="14-10-查看镜像"><a href="#14-10-查看镜像" class="headerlink" title="14.10 查看镜像"></a>14.10 查看镜像</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">查看已有镜像</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">默认安装完不存在镜像，需要从网上进行下载</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">镜像存放地址位于“/var/lib/glance/images”</span><br>openstack image list<br></code></pre></td></tr></table></figure>

<h3 id="15-安装配置nova计算和placement资源监控服务-controller节点"><a href="#15-安装配置nova计算和placement资源监控服务-controller节点" class="headerlink" title="15. 安装配置nova计算和placement资源监控服务(controller节点)"></a>15. 安装配置nova计算和placement资源监控服务(controller节点)</h3><h4 id="15-1-创建nova数据库"><a href="#15-1-创建nova数据库" class="headerlink" title="15.1 创建nova数据库"></a>15.1 创建nova数据库</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">登录数据库</span><br>mysql -u root -p<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"># 创建nova_api数据库<br><span class="hljs-keyword">CREATE</span> DATABASE nova_api;<br># 创建nova数据库 <br><span class="hljs-keyword">CREATE</span> DATABASE nova;<br># 创建nova_cell0数据库<br><span class="hljs-keyword">CREATE</span> DATABASE nova_cell0;<br><br># 创建placement数据库<br><span class="hljs-keyword">CREATE</span> DATABASE placement;<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs sql"># 创建nova用户并赋予“<span class="hljs-number">123456</span>”密码给该用户,最后赋予nova_api数据库的所有权限给该用户<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> nova_api.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;nova&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br># 给nova用户远程操作nova_api数据库的权限<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> nova_api.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;nova&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br># 创建nova用户并赋予“<span class="hljs-number">123456</span>”密码给该用户,最后赋予nova数据库的所有权限给该用户<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> nova.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;nova&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br># 给nova用户远程操作nova数据库的权限<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> nova.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;nova&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br># 创建nova用户并赋予“<span class="hljs-number">123456</span>”密码给该用户,最后赋予nova_cell0数据库的所有权限给该用户<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> nova_cell0.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;nova&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br># 给nova用户远程操作nova_cell0数据库的权限<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> nova_cell0.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;nova&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br># 创建placement用户并赋予“<span class="hljs-number">123456</span>”密码给该用户,最后赋予placement数据库的所有权限给该用户<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> placement.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;placement&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br># 给placement用户远程操作placement数据库的权限<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> placement.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;placement&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br><br># nova用户使用“mysql_native_password”认证插件进行认证<br><span class="hljs-keyword">UPDATE</span> mysql.user <span class="hljs-keyword">SET</span> authentication_string <span class="hljs-operator">=</span> PASSWORD(<span class="hljs-string">&#x27;123456&#x27;</span>), plugin <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;mysql_native_password&#x27;</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">User</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;nova&#x27;</span> <span class="hljs-keyword">AND</span> Host <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;%&#x27;</span>;<br># placement用户使用“mysql_native_password”认证插件进行认证<br><span class="hljs-keyword">UPDATE</span> mysql.user <span class="hljs-keyword">SET</span> authentication_string <span class="hljs-operator">=</span> PASSWORD(<span class="hljs-string">&#x27;123456&#x27;</span>), plugin <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;mysql_native_password&#x27;</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">User</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;placement&#x27;</span> <span class="hljs-keyword">AND</span> Host <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;%&#x27;</span>;<br><br># 刷新权限<br>flush privileges;<br><br># 退出数据库<br>exit<br><br><br></code></pre></td></tr></table></figure>

<h4 id="15-2-在keystone上注册nova服务"><a href="#15-2-在keystone上注册nova服务" class="headerlink" title="15.2 在keystone上注册nova服务"></a>15.2 在keystone上注册nova服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">切换为keystone管理员的系统环境</span><br>source /opt/adminrc-openstack<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">在local_user表中，创建一个用户名为【nova】，用户默认域为【default】，这里是交互式输入密码</span><br>openstack user create --domain default --password-prompt nova<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">将【nova】用户添加到【service】项目的【admin】角色组</span><br>openstack role add --project service --user nova admin<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">创建服务实体名为【nova】，实体描述为【OpenStack Compute】，服务实体类型为【compute】</span><br>openstack service create --name nova --description &quot;OpenStack Compute&quot; compute<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">验证nova服务实体是否创建成功【列出当前用户列表】</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">目前应该有3行数据，分别是keystone、glance和nova的数据，若没有，重新进行操作</span><br>openstack service list<br></code></pre></td></tr></table></figure>

<h4 id="15-3-在keystone上创建nova计算服务端点"><a href="#15-3-在keystone上创建nova计算服务端点" class="headerlink" title="15.3 在keystone上创建nova计算服务端点"></a>15.3 在keystone上创建nova计算服务端点</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">创建外部通信的URL端点</span><br>openstack endpoint create --region RegionOne compute public http://controller:8774/v2.1<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">创建内部通信的URL端点</span><br>openstack endpoint create --region RegionOne compute internal http://controller:8774/v2.1<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">创建管理员通信的URL端点</span><br>openstack endpoint create --region RegionOne compute admin http://controller:8774.v2.1<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">列出创建的端点列表</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">这是应该有9行数据，3条属于keystone服务的端点</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">3条属于glance服务的端点，另外3条属于nova服务</span><br>openstack endpoint list<br></code></pre></td></tr></table></figure>

<h4 id="15-4-在keystone上注册placement服务"><a href="#15-4-在keystone上注册placement服务" class="headerlink" title="15.4 在keystone上注册placement服务"></a>15.4 在keystone上注册placement服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">在local_user表中，创建一个用户名为【placement】，用户默认域为【default】，这里是交互式输入密码</span><br>openstack user create --domain default --password-prompt placement<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">将【placement】用户添加到【service】项目的【admin】角色组</span><br>openstack role add --project service --user placement admin<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">创建服务实体名为【placement】，实体描述为【Placement API】，服务实体类型为【placement】</span><br>openstack service create --name placement --description &quot;Placement API&quot; placement<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">验证placement服务实体是否创建成功【列出当前用户列表】</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">目前应该有4行数据，分别是keystone、glance、nova和placement的数据，若没有，重新进行操作</span><br>openstack service list<br></code></pre></td></tr></table></figure>

<h4 id="15-5-在keystone上创建placement资源服务端点"><a href="#15-5-在keystone上创建placement资源服务端点" class="headerlink" title="15.5 在keystone上创建placement资源服务端点"></a>15.5 在keystone上创建placement资源服务端点</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">创建外部通信的URL端点</span><br>openstack endpoint create --region RegionOne placement public http://controller:8778<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">创建内部通信的URL端点</span><br>openstack endpoint create --region RegionOne placement internal http://controller:8778<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">创建管理员通信的URL端点</span><br>openstack endpoint create --region RegionOne placement admin http://controller:8778<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">列出创建的端点列表</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">这是应该有12行数据，3条属于keystone服务的端点</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">3条属于glance服务的端点，3条属于nova服务,还有3条属于placement服务</span><br>openstack endpoint list<br></code></pre></td></tr></table></figure>

<h4 id="15-5-安装nova和placement服务"><a href="#15-5-安装nova和placement服务" class="headerlink" title="15.5 安装nova和placement服务"></a>15.5 安装nova和placement服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum install openstack-nova-api openstack-nova-conductor \<br>openstack-nova-console openstack-nova-novncproxy \<br>openstack-nova-scheduler openstack-nova-placement-api -y <br></code></pre></td></tr></table></figure>

<h4 id="15-6-配置nova以及placement的文件"><a href="#15-6-配置nova以及placement的文件" class="headerlink" title="15.6 配置nova以及placement的文件"></a>15.6 配置nova以及placement的文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务启用Compute API和Metadata API</span><br>openstack-config --set  /etc/nova/nova.conf DEFAULT enabled_apis  osapi_compute,metadata<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务主机的IP地址【即controller节点的IP地址】</span><br>openstack-config --set  /etc/nova/nova.conf DEFAULT my_ip 192.168.66.6<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务默认使用neutron服务</span><br>openstack-config --set  /etc/nova/nova.conf DEFAULT use_neutron  true <br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务使用<span class="hljs-string">&quot;nova.virt.firewall.NoopFirewallDriver&quot;</span>防火墙驱动</span><br>openstack-config --set  /etc/nova/nova.conf DEFAULT firewall_driver  nova.virt.firewall.NoopFirewallDriver<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务使用的rabbitmq服务器账户密码</span><br>openstack-config --set  /etc/nova/nova.conf DEFAULT transport_url rabbit://openstack:123456@controller<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务连接nova_api数据库的用户名以及密码</span><br>openstack-config --set  /etc/nova/nova.conf api_database connection mysql+pymysql://nova:123456@controller/nova_api<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务连接nova数据库的用户名以及密码</span><br>openstack-config --set  /etc/nova/nova.conf database connection  mysql+pymysql://nova:123456@controller/nova<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置placement服务连接placement数据库的用户名以及密码</span><br>openstack-config --set  /etc/nova/nova.conf placement_database connection  mysql+pymysql://placement:123456@controller/placement<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务的api认证策略是使用keystone服务</span><br>openstack-config --set  /etc/nova/nova.conf api auth_strategy  keystone <br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务的认证URL</span><br>openstack-config --set  /etc/nova/nova.conf keystone_authtoken auth_url  http://controller:5000/v3<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务使用memcached服务的服务器</span><br>openstack-config --set  /etc/nova/nova.conf keystone_authtoken memcached_servers  controller:11211<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务使用keystone认证服务的类型是密码</span><br>openstack-config --set  /etc/nova/nova.conf keystone_authtoken auth_type  password<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务在keystone服务里的默认项目域</span><br>openstack-config --set  /etc/nova/nova.conf keystone_authtoken project_domain_name  Default<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务在keystone服务里的普通用户默认域</span><br>openstack-config --set  /etc/nova/nova.conf keystone_authtoken user_domain_name  Default<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务在keystone服务里的项目是属于service</span><br>openstack-config --set  /etc/nova/nova.conf keystone_authtoken project_name  service <br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务在keystone服务里使用的默认账户是nova</span><br>openstack-config --set  /etc/nova/nova.conf keystone_authtoken username  nova <br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务在keystone服务里使用的nova账户的密码</span><br>openstack-config --set  /etc/nova/nova.conf keystone_authtoken password  123456<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务使用vnc远程连接服务</span><br>openstack-config --set  /etc/nova/nova.conf vnc enabled true<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务使用vnc远程服务的监听地址</span><br>openstack-config --set  /etc/nova/nova.conf vnc server_listen &#x27;$my_ip&#x27;<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务使用vnc远程服务的代理客户端地址</span><br>openstack-config --set  /etc/nova/nova.conf vnc server_proxyclient_address &#x27;$my_ip&#x27;<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务使用glance服务的地址</span><br>openstack-config --set  /etc/nova/nova.conf glance api_servers  http://controller:9292<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务的锁路径</span><br>openstack-config --set  /etc/nova/nova.conf oslo_concurrency lock_path  /var/lib/nova/tmp <br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务应该与哪个区域的 Placement 服务进行通信</span><br>openstack-config --set  /etc/nova/nova.conf placement region_name RegionOne<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置placement服务的默认项目域</span><br>openstack-config --set  /etc/nova/nova.conf placement project_domain_name Default<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置placement服务属于service项目</span><br>openstack-config --set  /etc/nova/nova.conf placement project_name service<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置placement服务在keystone服务的认证类型是密码</span><br>openstack-config --set  /etc/nova/nova.conf placement auth_type password<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置placement服务的普通用户默认域</span><br>openstack-config --set  /etc/nova/nova.conf placement user_domain_name Default<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置placement服务的认证URL</span><br>openstack-config --set  /etc/nova/nova.conf placement auth_url http://controller:5000/v3<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置placement服务使用的默认用户名是placement</span><br>openstack-config --set  /etc/nova/nova.conf placement username placement<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置placement服务使用placement用户的密码</span><br>openstack-config --set  /etc/nova/nova.conf placement password 123456<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务中检查主机列表更新的频率【这里是每5分钟-300秒检查一次】</span><br>openstack-config --set  /etc/nova/nova.conf scheduler discover_hosts_in_cells_interval 300<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">查看修改内容</span><br>grep &#x27;^[a-z]&#x27; /etc/nova/nova.conf<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">配置novnc可使用的协议</span><br>sed -i &quot;231s|protocols|[&#x27;binary&#x27;,&#x27;base64&#x27;]|&quot; /usr/share/novnc/core/websock.js<br></code></pre></td></tr></table></figure>

<h4 id="15-7-配置httpd服务"><a href="#15-7-配置httpd服务" class="headerlink" title="15.7 配置httpd服务"></a>15.7 配置httpd服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">httpd配置文件增加内容</span><br>cat &gt;&gt; /etc/httpd/conf.d/00-nova-placement-api.conf &lt;&lt; &quot;EOF&quot;<br><br>&lt;Directory /usr/bin&gt;<br>   &lt;IfVersion &gt;= 2.4&gt;<br>      Require all granted<br>   &lt;/IfVersion&gt;<br>   &lt;IfVersion &lt; 2.4&gt;<br>      Order allow,deny<br>      Allow from all<br>   &lt;/IfVersion&gt;<br>&lt;/Directory&gt;<br>EOF<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">重启httpd服务</span><br>systemctl restart httpd<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">查看httpd服务的状态</span><br>systemctl status httpd<br></code></pre></td></tr></table></figure>

<h4 id="15-8-同步nova以及placement数据库"><a href="#15-8-同步nova以及placement数据库" class="headerlink" title="15.8 同步nova以及placement数据库"></a>15.8 同步nova以及placement数据库</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">初始化nova和placement数据库</span><br>su -s /bin/sh -c &quot;nova-manage api_db sync&quot; nova<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">注册cell0数据库</span><br>su -s /bin/sh -c &quot;nova-manage cell_v2 map_cell0&quot; nova<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">创建cell1单元</span><br>su -s /bin/sh -c &quot;nova-manage cell_v2 create_cell --name=cell1 --verbose&quot; nova<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">注册nova数据库</span><br>su -s /bin/sh -c &quot;nova-manage db sync&quot; nova<br></code></pre></td></tr></table></figure>

<h4 id="15-9-验证数据库以及服务注册"><a href="#15-9-验证数据库以及服务注册" class="headerlink" title="15.9 验证数据库以及服务注册"></a>15.9 验证数据库以及服务注册</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">验证noca_cell0和cell1是否注册成功</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">此时应该出现2行数据，没有则注册不成功</span><br>su -s /bin/sh -c &quot;nova-manage cell_v2 list_cells&quot; nova<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">登录数据库</span><br>mysql -u root -p<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs sql"># 切换到nova_api数据库<br>use nova_api;<br><br># 查看nova_api数据库的表<br># 这里应该有<span class="hljs-number">32</span>行数据<br><span class="hljs-keyword">show</span> tables;<br><br># 切换到placement数据库<br>use placement;<br><br># 查看placement数据库的表<br># 这里同样应该有<span class="hljs-number">32</span>行数据<br><span class="hljs-keyword">show</span> tables;<br><br># 切换到nova_cell0数据库<br>use nova_cell0;<br><br># 查看nova_cell0数据库的表<br># 这里应该有<span class="hljs-number">110</span>行数据<br><span class="hljs-keyword">show</span> tables;<br><br># 切换到nova数据库<br>use nova;<br><br># 查看nova数据库的表<br># 这里应该有<span class="hljs-number">110</span>行数据<br><span class="hljs-keyword">show</span> tables;<br><br># 退出数据库<br>exit;<br></code></pre></td></tr></table></figure>

<h4 id="15-10-启动服务并设置开机自启动"><a href="#15-10-启动服务并设置开机自启动" class="headerlink" title="15.10 启动服务并设置开机自启动"></a>15.10 启动服务并设置开机自启动</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">启动nova有关服务</span><br>systemctl start openstack-nova-api openstack-nova-consoleauth \<br>openstack-nova-scheduler openstack-nova-conductor \<br>openstack-nova-novncproxy<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">查看nova有关服务的状态</span><br>systemctl status openstack-nova-api openstack-nova-consoleauth \<br>openstack-nova-scheduler openstack-nova-conductor \<br>openstack-nova-novncproxy<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">设置nova有关服务开机自启动</span><br>systemctl enable openstack-nova-api openstack-nova-consoleauth \<br>openstack-nova-scheduler openstack-nova-conductor \<br>openstack-nova-novncproxy<br></code></pre></td></tr></table></figure>

<h3 id="16-安装配置nova计算服务-computer节点"><a href="#16-安装配置nova计算服务-computer节点" class="headerlink" title="16. 安装配置nova计算服务(computer节点)"></a>16. 安装配置nova计算服务(computer节点)</h3><blockquote>
<p>以下内容均在computer节点上执行！！！</p>
</blockquote>
<h4 id="16-1-安装nova服务"><a href="#16-1-安装nova服务" class="headerlink" title="16.1 安装nova服务"></a>16.1 安装nova服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">在computer节点上执行</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">安装nova计算服务</span><br>yum install openstack-nova-compute -y<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">安装快速修改配置文件工具</span><br>yum install openstack-utils -y<br></code></pre></td></tr></table></figure>

<h4 id="16-2-配置nova服务"><a href="#16-2-配置nova服务" class="headerlink" title="16.2 配置nova服务"></a>16.2 配置nova服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务启用Compute API和Metadata API</span><br>openstack-config --set  /etc/nova/nova.conf DEFAULT enabled_apis  osapi_compute,metadata<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务主机的IP地址【即computer节点的IP地址】</span><br>openstack-config --set  /etc/nova/nova.conf DEFAULT my_ip 192.168.66.7<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务默认使用neutron服务</span><br>openstack-config --set  /etc/nova/nova.conf DEFAULT use_neutron true<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务使用<span class="hljs-string">&quot;nova.virt.firewall.NoopFirewallDriver&quot;</span>防火墙驱动</span><br>openstack-config --set  /etc/nova/nova.conf DEFAULT firewall_driver nova.virt.firewall.NoopFirewallDriver<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务使用的rabbitmq服务器账户密码</span><br>openstack-config --set  /etc/nova/nova.conf DEFAULT transport_url  rabbit://openstack:123456@controller<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务的api认证策略是使用keystone服务</span><br>openstack-config --set  /etc/nova/nova.conf api auth_strategy  keystone <br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务的认证URL</span><br>openstack-config --set  /etc/nova/nova.conf keystone_authtoken auth_url http://controller:5000/v3<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务使用memcached服务的服务器</span><br>openstack-config --set  /etc/nova/nova.conf keystone_authtoken memcached_servers controller:11211<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务使用keystone认证服务的类型是密码</span><br>openstack-config --set  /etc/nova/nova.conf keystone_authtoken auth_type password<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务在keystone服务里的默认项目域</span><br>openstack-config --set  /etc/nova/nova.conf keystone_authtoken project_domain_name default<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务在keystone服务里的普通用户默认域</span><br>openstack-config --set  /etc/nova/nova.conf keystone_authtoken user_domain_name default<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务在keystone服务里的项目是属于service</span><br>openstack-config --set  /etc/nova/nova.conf keystone_authtoken project_name  service<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务在keystone服务里使用的默认账户是nova</span><br>openstack-config --set  /etc/nova/nova.conf keystone_authtoken username nova<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务在keystone服务里使用的nova账户的密码</span><br>openstack-config --set  /etc/nova/nova.conf keystone_authtoken password 123456<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务使用vnc远程连接服务</span><br>openstack-config --set  /etc/nova/nova.conf vnc enabled true<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务使用vnc远程服务的监听地址</span><br>openstack-config --set  /etc/nova/nova.conf vnc server_listen 0.0.0.0<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务使用vnc远程服务的代理客户端地址</span><br>openstack-config --set  /etc/nova/nova.conf vnc server_proxyclient_address  &#x27;$my_ip&#x27;<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务使用novnc远程服务的基本URL</span><br>openstack-config --set  /etc/nova/nova.conf vnc novncproxy_base_url http://controller:6080/vnc_auto.html<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务使用glance服务的地址</span><br>openstack-config --set  /etc/nova/nova.conf glance api_servers http://controller:9292<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务的锁路径</span><br>openstack-config --set  /etc/nova/nova.conf oslo_concurrency lock_path /var/lib/nova/tmp<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务应该与哪个区域的 Placement 服务进行通信</span><br>openstack-config --set  /etc/nova/nova.conf placement region_name RegionOne<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置placement服务的默认项目域</span><br>openstack-config --set  /etc/nova/nova.conf placement project_domain_name Default<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置placement服务属于service项目</span><br>openstack-config --set  /etc/nova/nova.conf placement project_name service<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置placement服务在keystone服务的认证类型是密码</span><br>openstack-config --set  /etc/nova/nova.conf placement auth_type password<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置placement服务的普通用户默认域</span><br>openstack-config --set  /etc/nova/nova.conf placement user_domain_name Default<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置placement服务的认证URL</span><br>openstack-config --set  /etc/nova/nova.conf placement auth_url http://controller:5000/v3<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置placement服务使用的默认用户名是placement</span><br>openstack-config --set  /etc/nova/nova.conf placement username placement<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置placement服务使用placement用户的密码</span><br>openstack-config --set  /etc/nova/nova.conf placement password 123456<br><br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">查看修改内容</span><br>grep &#x27;^[a-z]&#x27; /etc/nova/nova.conf<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">查看计算节点是否支持虚拟化</span><br>egrep -c &#x27;(vmx|svm)&#x27; /proc/cpuinfo<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">若输出除“0”以外的任何数，则无需操作</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">！！！！！若输出“0”，则代表不支持硬件加速，需要以下配置！！！！！！</span><br>openstack-config --set  /etc/nova/nova.conf libvirt virt_type  qemu<br><br><br></code></pre></td></tr></table></figure>

<h4 id="16-3-启动nova以及依赖服务"><a href="#16-3-启动nova以及依赖服务" class="headerlink" title="16.3 启动nova以及依赖服务"></a>16.3 启动nova以及依赖服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">启动nova以及依赖服务</span><br>systemctl start libvirtd openstack-nova-compute<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">查看nova以及依赖服务的状态</span><br>systemctl status libvirtd openstack-nova-compute<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">让nova以及依赖服务开机自启动</span><br>systemctl enable libvirtd openstack-nova-compute<br></code></pre></td></tr></table></figure>

<h4 id="16-4-在controller节点查看节点信息"><a href="#16-4-在controller节点查看节点信息" class="headerlink" title="16.4 在controller节点查看节点信息"></a>16.4 在controller节点查看节点信息</h4><blockquote>
<p>这一步在controller节点上执行</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">让管理员环境变量生效</span><br>source /opt/adminrc-openstack<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">查看数据库中是否有新的计算节点信息</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置了（5分钟——300秒）自动发现服务</span><br>openstack compute service list --service nova-compute<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">这里可以手动发现计算节点</span><br>su -s /bin/sh -c &quot;nova-manage cell_v2 discover_hosts --verbose&quot; nova<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">查看目前controller节点所有服务的状态</span><br>nova-status upgrade check<br></code></pre></td></tr></table></figure>

<h3 id="17-安装配置neutron网络服务-controller节点"><a href="#17-安装配置neutron网络服务-controller节点" class="headerlink" title="17. 安装配置neutron网络服务(controller节点)"></a>17. 安装配置neutron网络服务(controller节点)</h3><h4 id="17-1-创建neutron数据库"><a href="#17-1-创建neutron数据库" class="headerlink" title="17.1 创建neutron数据库"></a>17.1 创建neutron数据库</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">进入数据库</span><br>mysql -u root -p <br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql"># 创建neutron数据库<br><span class="hljs-keyword">CREATE</span> DATABASE neutron;<br><br># 创建neutron用户并赋予“<span class="hljs-number">123456</span>”密码给该用户,最后赋予neutron数据库的所有权限给该用户<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> neutron.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;neutron&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br><br># 给neutron用户远程操作neutron数据库的权限<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> neutron.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;neutron&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br><br># neutron用户使用“mysql_native_password”认证插件进行认证<br><span class="hljs-keyword">UPDATE</span> mysql.user <span class="hljs-keyword">SET</span> authentication_string <span class="hljs-operator">=</span> PASSWORD(<span class="hljs-string">&#x27;123456&#x27;</span>), plugin <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;mysql_native_password&#x27;</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">User</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;neutron&#x27;</span> <span class="hljs-keyword">AND</span> Host <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;%&#x27;</span>;<br><br># 刷新数据库权限<br>flush privileges;<br><br># 退出数据库<br>exit<br></code></pre></td></tr></table></figure>

<h4 id="17-2-在keystone上注册neutron服务"><a href="#17-2-在keystone上注册neutron服务" class="headerlink" title="17.2 在keystone上注册neutron服务"></a>17.2 在keystone上注册neutron服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">切换为keystone管理员的系统环境</span><br>source /opt/adminrc-openstack<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">在local_user表中，创建一个用户名为【neutron】，用户默认域为【default】，这里是交互式输入密码</span><br>openstack user create --domain default --password-prompt neutron<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">将【neutron】用户添加到【service】项目的【admin】角色组</span><br>openstack role add --project service --user neutron admin<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">创建服务实体名为【neutron】，实体描述为【OpenStack Networking】，服务实体类型为【network】</span><br>openstack service create --name neutron --description &quot;OpenStack Networking&quot; network<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">验证nova服务实体是否创建成功【列出当前用户列表】</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">目前应该有5行数据，分别是keystone、glance、nova、placement和neutron的数据，若没有，重新进行操作</span><br>openstack service list<br></code></pre></td></tr></table></figure>

<h4 id="17-3-在keystone上创建neutron服务端点"><a href="#17-3-在keystone上创建neutron服务端点" class="headerlink" title="17.3 在keystone上创建neutron服务端点"></a>17.3 在keystone上创建neutron服务端点</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">创建外部通信的URL端点</span><br>openstack endpoint create --region RegionOne network public http://controller:9696<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">创建内部通信的URL端点</span><br>openstack endpoint create --region RegionOne network internal http://controller:9696<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">创建管理员通信的URL端点</span><br>openstack endpoint create --region RegionOne network admin http://controller:9696<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">列出创建的端点列表</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">这是应该有15行数据，3条属于keystone服务的端点</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">3条属于glance服务，3条属于nova服务,3条属于placement服务</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">另外3条属于neutron服务</span><br>openstack endpoint list<br></code></pre></td></tr></table></figure>

<h4 id="17-4-安装neutron网络服务"><a href="#17-4-安装neutron网络服务" class="headerlink" title="17.4 安装neutron网络服务"></a>17.4 安装neutron网络服务</h4><blockquote>
<p>这里有两种安装方式：<code>Provider networks</code>，<code>Self-service networks</code></p>
<ul>
<li><p>方式一：通常依赖物理网络来实现三层路由功能；仅支持Flat和VLAN两种网络类型</p>
</li>
<li><p>方式二：网络完全虚拟化，不依赖于物理网络设备，可以直接使用三层路由功能；支持Flat、VLAN、VXLAN和GRE等多种网络类型；从某种意义来说<code>方式二</code>是基于<code>方式一</code>的基础上搭建的</p>
</li>
</ul>
</blockquote>
<ul>
<li>这里我选择<code>方式二</code>搭建</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">安装neutron以及依赖服务</span><br>yum install openstack-neutron openstack-neutron-ml2 \<br>openstack-neutron-linuxbridge ebtables -y <br><br><br></code></pre></td></tr></table></figure>

<h4 id="17-5-配置neutron服务的文件"><a href="#17-5-配置neutron服务的文件" class="headerlink" title="17.5 配置neutron服务的文件"></a>17.5 配置neutron服务的文件</h4><ul>
<li>配置neutron服务</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务连接neutron数据库的用户名以及密码</span><br>openstack-config --set  /etc/neutron/neutron.conf database connection  mysql+pymysql://neutron:123456@controller/neutron <br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务的核心插件是ml2</span><br>openstack-config --set  /etc/neutron/neutron.conf DEFAULT core_plugin  ml2  <br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务启用router插件</span><br>openstack-config --set  /etc/neutron/neutron.conf DEFAULT service_plugins  router<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务的子网可以使用重叠的IP地址范围</span><br>openstack-config --set  /etc/neutron/neutron.conf DEFAULT allow_overlapping_ips  true<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务使用rabbitmq服务器的地址</span><br>openstack-config --set  /etc/neutron/neutron.conf DEFAULT transport_url rabbit://openstack:123456@controller<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务的认证策略是keystone</span><br>openstack-config --set  /etc/neutron/neutron.conf DEFAULT auth_strategy  keystone  <br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务的公共认证URL</span><br>openstack-config --set  /etc/neutron/neutron.conf keystone_authtoken www_authenticate_uri  http://controller:5000<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务的认证URL</span><br>openstack-config --set  /etc/neutron/neutron.conf keystone_authtoken auth_url  http://controller:5000<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务使用memcached服务器的地址</span><br>openstack-config --set  /etc/neutron/neutron.conf keystone_authtoken memcached_servers  controller:11211<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务的认证类型</span><br>openstack-config --set  /etc/neutron/neutron.conf keystone_authtoken auth_type  password  <br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务默认的项目域</span><br>openstack-config --set  /etc/neutron/neutron.conf keystone_authtoken project_domain_name default  <br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务的默认普通用户域</span><br>openstack-config --set  /etc/neutron/neutron.conf keystone_authtoken user_domain_name  default  <br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置nova服务在keystone服务里的项目是属于service</span><br>openstack-config --set  /etc/neutron/neutron.conf keystone_authtoken project_name  service  <br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务在keystone服务里使用的默认账户是neutron</span><br>openstack-config --set  /etc/neutron/neutron.conf keystone_authtoken username  neutron  <br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务在keystone服务里使用neutron账户的密码</span><br>openstack-config --set  /etc/neutron/neutron.conf keystone_authtoken password  123456  <br><span class="hljs-meta prompt_"># </span><span class="language-bash">启用neutron服务的端口状态发生变化时，将会发送通知给nova服务</span><br>openstack-config --set  /etc/neutron/neutron.conf DEFAULT notify_nova_on_port_status_changes  true<br><span class="hljs-meta prompt_"># </span><span class="language-bash">启用neutron服务的端口发生变化时，将会发送通知给nova服务</span><br>openstack-config --set  /etc/neutron/neutron.conf DEFAULT notify_nova_on_port_data_changes  true<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务使用nova服务的认证URL</span><br>openstack-config --set  /etc/neutron/neutron.conf nova auth_url  http://controller:5000<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务使用nova服务的认证类型</span><br>openstack-config --set  /etc/neutron/neutron.conf nova auth_type  password <br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务使用nova服务的默认项目域</span><br>openstack-config --set  /etc/neutron/neutron.conf nova project_domain_name  default  <br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务使用nova服务的默认普通用户域</span><br>openstack-config --set  /etc/neutron/neutron.conf nova user_domain_name  default  <br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务使用nova服务的注册名</span><br>openstack-config --set  /etc/neutron/neutron.conf nova region_name  RegionOne  <br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务在nova服务里的项目是属于service</span><br>openstack-config --set  /etc/neutron/neutron.conf nova project_name  service  <br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务使用nova服务的用户名</span><br>openstack-config --set  /etc/neutron/neutron.conf nova username  nova  <br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务使用nova服务的密码</span><br>openstack-config --set  /etc/neutron/neutron.conf nova password  123456  <br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务的锁路径</span><br>openstack-config --set  /etc/neutron/neutron.conf oslo_concurrency lock_path  /var/lib/neutron/tmp<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">查看修改内容</span><br>grep &#x27;^[a-z]&#x27; /etc/neutron/neutron.conf<br></code></pre></td></tr></table></figure>

<ul>
<li>配置neutron服务中的ml2插件</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">配置ml2插件使用的驱动类型</span><br>openstack-config --set  /etc/neutron/plugins/ml2/ml2_conf.ini ml2 type_drivers  flat,vlan,vxlan<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置ml2插件中租户使用的网络类型</span><br>openstack-config --set  /etc/neutron/plugins/ml2/ml2_conf.ini ml2 tenant_network_types  vxlan<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置ml2插件的机制驱动</span><br>openstack-config --set  /etc/neutron/plugins/ml2/ml2_conf.ini ml2 mechanism_drivers  linuxbridge,l2population<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置ml2插件的端口拓展驱动</span><br>openstack-config --set  /etc/neutron/plugins/ml2/ml2_conf.ini ml2 extension_drivers  port_security<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置ml2插件使用名为provier的物理网络作为扁平网络</span><br>openstack-config --set  /etc/neutron/plugins/ml2/ml2_conf.ini ml2_type_flat flat_networks  provider<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置ml2插件中vxlan的范围是1-1000</span><br>openstack-config --set  /etc/neutron/plugins/ml2/ml2_conf.ini ml2_type_vxlan vni_ranges  1:1000<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置ml2插件启用ipset安全组规则</span><br>openstack-config --set  /etc/neutron/plugins/ml2/ml2_conf.ini securitygroup enable_ipset  true<br><br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">查看修改内容</span><br>grep &#x27;^[a-z]&#x27; /etc/neutron/plugins/ml2/ml2_conf.ini<br></code></pre></td></tr></table></figure>

<ul>
<li>配置neutron服务中ml2插件的linux网桥</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">配置linux网桥的接口</span><br>openstack-config --set   /etc/neutron/plugins/ml2/linuxbridge_agent.ini linux_bridge physical_interface_mappings  provider:eth0<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置linux网桥启用vxlan</span><br>openstack-config --set   /etc/neutron/plugins/ml2/linuxbridge_agent.ini vxlan  enable_vxlan  true<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置linux网桥的本地IP地址</span><br>openstack-config --set   /etc/neutron/plugins/ml2/linuxbridge_agent.ini vxlan  local_ip  192.168.66.6<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置linux网桥启用vxlan网络的二层广播域信息分发</span><br>openstack-config --set   /etc/neutron/plugins/ml2/linuxbridge_agent.ini vxlan  l2_population  true<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置linux网桥启用安全组</span><br>openstack-config --set   /etc/neutron/plugins/ml2/linuxbridge_agent.ini securitygroup  enable_security_group  true<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置linux网桥设置安全组驱动</span><br>openstack-config --set   /etc/neutron/plugins/ml2/linuxbridge_agent.ini securitygroup  firewall_driver neutron.agent.linux.iptables_firewall.IptablesFirewallDriver<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">查看修改内容</span><br>grep &#x27;^[a-z]&#x27; /etc/neutron/plugins/ml2/linuxbridge_agent.ini<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">内核模块在重启后依然被加载</span><br>echo &#x27;br_netfilter&#x27; &gt; /etc/modules-load.d/br_netfilter.conf<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">重新加载bridge模块</span><br>modprobe -r bridge<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">重新加载br_netfilter模块</span><br>modprobe br_netfilter<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">永久允许Linux内核中网桥与iptables防火墙规则之间的交互</span><br>echo &#x27;net.bridge.bridge-nf-call-iptables = 1&#x27; &gt;&gt; /etc/sysctl.conf<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">永久允许Linux内核中网桥与iptables6防火墙规则之间的交互</span><br>echo &#x27;net.bridge.bridge-nf-call-ip6tables = 1&#x27; &gt;&gt; /etc/sysctl.conf<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">应用设置</span><br>sysctl -p<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务中的dhcp服务使用的接口驱动</span><br>openstack-config --set   /etc/neutron/dhcp_agent.ini DEFAULT  interface_driver  linuxbridge<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务中dhcp服务使用的dns驱动</span><br>openstack-config --set   /etc/neutron/dhcp_agent.ini DEFAULT  dhcp_driver  neutron.agent.linux.dhcp.Dnsmasq<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务服务启用元数据存储</span><br>openstack-config --set   /etc/neutron/dhcp_agent.ini DEFAULT  enable_isolated_metadata  true<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">查看修改内容</span><br>grep &#x27;^[a-z]&#x27; /etc/neutron/dhcp_agent.ini<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务的元数据主机</span><br>openstack-config --set /etc/neutron/metadata_agent.ini DEFAULT nova_metadata_host controller<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务的元数据代理共享密钥</span><br>openstack-config --set /etc/neutron/metadata_agent.ini DEFAULT metadata_proxy_shared_secret 123456<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">查看修改内容</span><br>grep &#x27;^[a-z]&#x27; /etc/neutron/metadata_agent.ini<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">补充配置nova服务使用neutron服务的URL</span><br>openstack-config --set  /etc/nova/nova.conf  neutron url http://controller:9696<br><span class="hljs-meta prompt_"># </span><span class="language-bash">补充配置nova服务使用neutron服务的外部认证URL</span><br>openstack-config --set  /etc/nova/nova.conf  neutron auth_url http://controller:5000<br><span class="hljs-meta prompt_"># </span><span class="language-bash">补充配置nova服务使用neutron服务的认证类型</span><br>openstack-config --set  /etc/nova/nova.conf  neutron auth_type password<br><span class="hljs-meta prompt_"># </span><span class="language-bash">补充配置nova服务使用neutron服务的默认项目域</span><br>openstack-config --set  /etc/nova/nova.conf  neutron project_domain_name default<br><span class="hljs-meta prompt_"># </span><span class="language-bash">补充配置nova服务使用neutron服务的普通用户域</span><br>openstack-config --set  /etc/nova/nova.conf  neutron user_domain_name default<br><span class="hljs-meta prompt_"># </span><span class="language-bash">补充配置nova服务使用neutron服务的区域名</span><br>openstack-config --set  /etc/nova/nova.conf  neutron region_name RegionOne<br><span class="hljs-meta prompt_"># </span><span class="language-bash">补充配置neutron服务属于【service】项目</span><br>openstack-config --set  /etc/nova/nova.conf  neutron project_name service<br><span class="hljs-meta prompt_"># </span><span class="language-bash">补充配置neutron服务使用的用户名</span><br>openstack-config --set  /etc/nova/nova.conf  neutron username neutron<br><span class="hljs-meta prompt_"># </span><span class="language-bash">补充配置neutron服务使用的密码</span><br>openstack-config --set  /etc/nova/nova.conf  neutron password 123456<br><span class="hljs-meta prompt_"># </span><span class="language-bash">补充配置neutron服务启用元数据代理服务</span><br>openstack-config --set  /etc/nova/nova.conf  neutron service_metadata_proxy true<br><span class="hljs-meta prompt_"># </span><span class="language-bash">补充配置neutron服务使用元数据代理共享密钥</span><br>openstack-config --set  /etc/nova/nova.conf  neutron metadata_proxy_shared_secret 123456<br><br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">查看修改内容</span><br>egrep -v &quot;^#|^$&quot; /etc/nova/nova.conf<br></code></pre></td></tr></table></figure>

<h4 id="17-6-创建网络插件的文件链接"><a href="#17-6-创建网络插件的文件链接" class="headerlink" title="17.6 创建网络插件的文件链接"></a>17.6 创建网络插件的文件链接</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">创建网络插件的链接</span><br>ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini<br><br><br></code></pre></td></tr></table></figure>

<h4 id="17-7-同步数据库"><a href="#17-7-同步数据库" class="headerlink" title="17.7 同步数据库"></a>17.7 同步数据库</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">同步neutron数据库</span><br>su -s /bin/sh -c &quot;neutron-db-manage --config-file /etc/neutron/neutron.conf --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head&quot; neutron<br></code></pre></td></tr></table></figure>

<h4 id="17-8-重启neutron以及依赖服务"><a href="#17-8-重启neutron以及依赖服务" class="headerlink" title="17.8 重启neutron以及依赖服务"></a>17.8 重启neutron以及依赖服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">首先重启nova-api服务</span><br>systemctl restart openstack-nova-api<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">查看nova-api服务的状态</span><br>systemctl status openstack-nova-api<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">重启neutron以及依赖服务</span><br>systemctl restart neutron-server neutron-linuxbridge-agent \<br>neutron-dhcp-agent neutron-metadata-agent <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">因为选择Self-service networks部署，还需要重启其他服务</span><br>systemctl restart neutron-l3-agent<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">查看neutron以及依赖服务的状态</span><br>systemctl status neutron-server neutron-linuxbridge-agent \<br>neutron-dhcp-agent neutron-metadata-agent neutron-l3-agent<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">让neutron以及依赖服务开机自启动</span><br>systemctl enable neutron-server neutron-linuxbridge-agent \<br>neutron-dhcp-agent neutron-metadata-agent neutron-l3-agent<br></code></pre></td></tr></table></figure>

<h3 id="18-安装配置neutron网络服务-computer节点"><a href="#18-安装配置neutron网络服务-computer节点" class="headerlink" title="18. 安装配置neutron网络服务(computer节点)"></a>18. 安装配置neutron网络服务(computer节点)</h3><h4 id="18-1-安装neutron服务"><a href="#18-1-安装neutron服务" class="headerlink" title="18.1 安装neutron服务"></a>18.1 安装neutron服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">computer节点安装neutron服务</span><br>yum install openstack-neutron-linuxbridge ebtables ipset -y <br></code></pre></td></tr></table></figure>

<h4 id="18-2-配置neutron服务"><a href="#18-2-配置neutron服务" class="headerlink" title="18.2 配置neutron服务"></a>18.2 配置neutron服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务使用rabbitmq服务器的地址</span><br>openstack-config --set /etc/neutron/neutron.conf DEFAULT transport_url  rabbit://openstack:123456@controller<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务使用的认证策略是keystone服务</span><br>openstack-config --set /etc/neutron/neutron.conf DEFAULT auth_strategy keystone<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务使用keystone服务的外部URL</span><br>openstack-config --set /etc/neutron/neutron.conf keystone_authtoken www_authenticate_uri  http://controller:5000<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务使用keystone服务的内部URL</span><br>openstack-config --set /etc/neutron/neutron.conf keystone_authtoken auth_url http://controller:5000<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务使用memcached的服务器地址</span><br>openstack-config --set /etc/neutron/neutron.conf keystone_authtoken memcached_servers controller:11211<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务使用keystone服务的认证类型</span><br>openstack-config --set /etc/neutron/neutron.conf keystone_authtoken auth_type password<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务在keystone服务中的默认项目域</span><br>openstack-config --set /etc/neutron/neutron.conf keystone_authtoken project_domain_name default<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务在keystone服务中的普通用户域</span><br>openstack-config --set /etc/neutron/neutron.conf keystone_authtoken user_domain_name default<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务在keystone服务中属于【service】项目</span><br>openstack-config --set /etc/neutron/neutron.conf keystone_authtoken project_name service<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务在keystone服务中使用的用户名</span><br>openstack-config --set /etc/neutron/neutron.conf keystone_authtoken username neutron<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务在keystone服务中neutron用户使用的密码</span><br>openstack-config --set /etc/neutron/neutron.conf keystone_authtoken password 123456<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务锁的路径</span><br>openstack-config --set /etc/neutron/neutron.conf oslo_concurrency lock_path /var/lib/neutron/tmp<br><br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">查看修改内容</span><br>grep &#x27;^[a-z]&#x27; /etc/neutron/neutron.conf<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务的外部URL</span><br>openstack-config --set /etc/nova/nova.conf neutron url http://controller:9696<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务的内部URL</span><br>openstack-config --set /etc/nova/nova.conf neutron auth_url http://controller:5000<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务的认证类型</span><br>openstack-config --set /etc/nova/nova.conf neutron auth_type password<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务的项目域</span><br>openstack-config --set /etc/nova/nova.conf neutron project_domain_name default<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务的普通用户域</span><br>openstack-config --set /etc/nova/nova.conf neutron user_domain_name default<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务的注册名</span><br>openstack-config --set /etc/nova/nova.conf neutron region_name RegionOne<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务的项目名</span><br>openstack-config --set /etc/nova/nova.conf neutron project_name service <br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务使用的用户名</span><br>openstack-config --set /etc/nova/nova.conf neutron username neutron<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务使用neutron用户的密码</span><br>openstack-config --set /etc/nova/nova.conf neutron password 123456<br><br><br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">查看修改内容</span><br>egrep -v &quot;^#|^$&quot; /etc/nova/nova.conf<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务中ml2插件的linux网桥的物理接口</span><br>openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini linux_bridge physical_interface_mappings  provider:eth0<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务中ml2插件的linux网桥启用vxlan</span><br>openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini vxlan enable_vxlan true<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务中的ml2插件的linux网桥的本地IP地址</span><br>openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini vxlan local_ip 192.168.66.7<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务中的ml2插件的linux网桥启用vxlan网络的二层广播域信息分发</span><br>openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini vxlan l2_population true<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务中的ml2插件的linux网桥启用安全组</span><br>openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini securitygroup enable_security_group true<br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置neutron服务中的ml2插件的linux网桥设置安全组驱动</span><br>openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini securitygroup firewall_driver neutron.agent.linux.iptables_firewall.IptablesFirewallDriver<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">查看修改内容</span><br>grep &#x27;^[a-z]&#x27; /etc/neutron/plugins/ml2/linuxbridge_agent.ini<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">内核模块在重启后依然被加载</span><br>echo &#x27;br_netfilter&#x27; &gt; /etc/modules-load.d/br_netfilter.conf<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">重新加载bridge模块</span><br>modprobe -r bridge<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">重新加载br_netfilter模块</span><br>modprobe br_netfilter<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">永久允许Linux内核中网桥与iptables防火墙规则之间的交互</span><br>echo &#x27;net.bridge.bridge-nf-call-iptables = 1&#x27; &gt;&gt; /etc/sysctl.conf<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">永久允许Linux内核中网桥与iptables6防火墙规则之间的交互</span><br>echo &#x27;net.bridge.bridge-nf-call-ip6tables = 1&#x27; &gt;&gt; /etc/sysctl.conf<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">应用设置</span><br>sysctl -p<br></code></pre></td></tr></table></figure>

<h4 id="18-3-启动neutron服务"><a href="#18-3-启动neutron服务" class="headerlink" title="18.3 启动neutron服务"></a>18.3 启动neutron服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">启动neutron网络服务以及nova计算服务</span><br>systemctl restart openstack-nova-compute neutron-linuxbridge-agent<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">查看两个服务的状态</span><br>systemctl status openstack-nova-compute neutron-linuxbridge-agent<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">让neutron服务能够开机自动启动</span><br>systemctl enable neutron-linuxbridge-agent<br></code></pre></td></tr></table></figure>

<h4 id="18-4-在controller节点验证"><a href="#18-4-在controller节点验证" class="headerlink" title="18.4 在controller节点验证"></a>18.4 在controller节点验证</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">在contorller节点验证computer节点是否成功启动</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">使用管理员系统变量</span><br>source /opt/adminrc-openstack<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">列出neutron服务拓展列表</span><br>neutron ext-list<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">列出neutron服务的代理列表</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">正常情况下，控制节点有3个服务，计算节点有1个服务</span><br>openstack network agent list<br></code></pre></td></tr></table></figure>

<h3 id="19-安装配置dashboard面板-controller节点"><a href="#19-安装配置dashboard面板-controller节点" class="headerlink" title="19. 安装配置dashboard面板(controller节点)"></a>19. 安装配置dashboard面板(controller节点)</h3><h4 id="19-1-安装dashboard服务"><a href="#19-1-安装dashboard服务" class="headerlink" title="19.1 安装dashboard服务"></a>19.1 安装dashboard服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">安装dashboard软件包</span><br>yum install openstack-dashboard -y <br></code></pre></td></tr></table></figure>

<h4 id="19-2-配置dashboard服务"><a href="#19-2-配置dashboard服务" class="headerlink" title="19.2 配置dashboard服务"></a>19.2 配置dashboard服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">备份原有配置</span><br>cp /etc/openstack-dashboard/local_settings /etc/openstack-dashboard/local_settings.bak<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">将openstack-dashboard的主机改为任意地址【0.0.0.0】或主机名或【controller】的IP地址</span><br>sed -i &quot;184s|127.0.0.1|controller|&quot; /etc/openstack-dashboard/local_settings<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置通过仪表盘创建的用户默认角色配置为 user</span><br>sed -i &quot;186s|&quot;_member_&quot;|&quot;user&quot;|&quot; /etc/openstack-dashboard/local_settings<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置openstack-dashboard允许以任意主机名访问</span><br>sed -i &quot;38s|&#x27;horizon.example.com&#x27;|&#x27;*&#x27;|&quot; /etc/openstack-dashboard/local_settings<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置memcached存储服务</span><br>sed -i &quot;163s|locmem.LocMemCache|memcached.MemcachedCache|&quot; /etc/openstack-dashboard/local_settings<br>sed -i &quot;163 a &#x27;LOCATION&#x27;: &#x27;controller:11211&#x27;,&quot; /etc/openstack-dashboard/local_settings<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">启用openstack对多域的支持</span><br>sed -i &quot;75s|#||&quot; /etc/openstack-dashboard/local_settings<br>sed -i &quot;75s|False|True|&quot; /etc/openstack-dashboard/local_settings<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">将配置API的注释删除，以配置openstack的API版本</span><br>sed -i &quot;64s|#||&quot; /etc/openstack-dashboard/local_settings<br>sed -i &quot;66s|#||&quot; /etc/openstack-dashboard/local_settings<br>sed -i &quot;67s|#||&quot; /etc/openstack-dashboard/local_settings<br>sed -i &quot;68s|#||&quot; /etc/openstack-dashboard/local_settings<br>sed -i &quot;70s|#||&quot; /etc/openstack-dashboard/local_settings<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">将通过仪表盘创建用户时的默认域的注释删除</span><br>sed -i &quot;97s|#||&quot; /etc/openstack-dashboard/local_settings<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">因我选择的是部署私有网络，所以启用3层网络支持</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">启用分布式路由</span><br>sed -i &quot;329s|False|True|&quot; /etc/openstack-dashboard/local_settings<br><span class="hljs-meta prompt_"># </span><span class="language-bash">启用高可用路由</span><br>sed -i &quot;330s|False|True|&quot; /etc/openstack-dashboard/local_settings<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">将默认时区配置为上海</span><br>sed -i &quot;465s|UTC|Asia/Shanghai|&quot; /etc/openstack-dashboard/local_settings<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置dashboard会话引擎</span><br>echo &quot;SESSION_ENGINE = &#x27;django.contrib.sessions.backends.cache&#x27;&quot; &gt;&gt; /etc/openstack-dashboard/local_settings<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">添加httpd的应用组</span><br>sed -i &quot;3 a WSGIApplicationGroup %&#123;GLOBAL&#125;&quot; /etc/httpd/conf.d/openstack-dashboard.conf <br><br><br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">将dashboard目录所有者给web服务的用户和组</span><br>chown -R apache:apache   /usr/share/openstack-dashboard/<br></code></pre></td></tr></table></figure>

<h4 id="19-3-启动web和会话存储服务"><a href="#19-3-启动web和会话存储服务" class="headerlink" title="19.3 启动web和会话存储服务"></a>19.3 启动web和会话存储服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">重启web服务以及会话存储服务</span><br>systemctl restart httpd memcached<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">查看web服务以及会话存储服务的状态</span><br>systemctl status httpd memcached<br></code></pre></td></tr></table></figure>

<h3 id="20-登录dashboard"><a href="#20-登录dashboard" class="headerlink" title="20. 登录dashboard"></a>20. 登录dashboard</h3><ul>
<li><p>浏览器输入<code>http://192.168.66.6/dashboard</code></p>
</li>
<li><p>这个<code>192.168.66.6</code>是controller节点的IP地址，根据自己的IP地址填写</p>
</li>
</ul>
<blockquote>
<ul>
<li><p>这里的信息是在<code>keystone-manage bootstrap</code>指令里指定的</p>
</li>
<li><p>如果根据以上教程来，信息在<code>/opt/adminrc-openstack</code>即”管理员环境变量“</p>
</li>
</ul>
<p>域：default</p>
<p>用户名：admin</p>
<p>密码：kst123456</p>
</blockquote>
<h1 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h1><h2 id="1-如果出现Failed-to-discover-available-identity-versions-when-contacting-http-controller-5000-v3"><a href="#1-如果出现Failed-to-discover-available-identity-versions-when-contacting-http-controller-5000-v3" class="headerlink" title="1. 如果出现Failed to discover available identity versions when contacting http://controller:5000/v3"></a>1. 如果出现Failed to discover available identity versions when contacting <a target="_blank" rel="noopener" href="http://controller:5000/v3">http://controller:5000/v3</a></h2><ul>
<li>根据这个的指导完成：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_47733361/article/details/123600852">【已解决】Failed to discover available identity versions when contacting http://controller:5000/v3.-CSDN博客</a></li>
</ul>
<h2 id="2-如果出现了mariadb不能远程登录的问题参考以下网址"><a href="#2-如果出现了mariadb不能远程登录的问题参考以下网址" class="headerlink" title="2. 如果出现了mariadb不能远程登录的问题参考以下网址"></a>2. 如果出现了mariadb不能远程登录的问题参考以下网址</h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/wujuncheng/p/13388988.html">在Linux中安装MariaDB并添加远程访问 - 吴俊城 - 博客园</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.daweibro.com/node/308#:~:text=%E5%AE%89%E8%A3%85%20MariaDB%2010.3%20%E4%BB%A5%E5%90%8E%EF%BC%8C%E9%BB%98%E8%AE%A4%E6%98%AF%E4%BD%BF%E7%94%A8%20root%20%E7%94%A8%E6%88%B7%E7%9B%B4%E6%8E%A5%E9%80%9A%E8%BF%87Unix%20Socket,%E7%99%BB%E5%BD%95%E8%80%8C%E4%B8%8D%E4%BD%BF%E7%94%A8%E5%AF%86%E7%A0%81%E7%9A%84%E3%80%82%20%E8%A6%81%E5%88%87%E6%8D%A2%E6%88%90%E4%BD%BF%E7%94%A8%E5%AF%86%E7%A0%81%E7%99%BB%E5%BD%95%E7%9A%84%E8%AF%9D%EF%BC%8C%E9%9C%80%E8%A6%81%E6%8A%8A%20%E9%BB%98%E8%AE%A4%E7%9A%84plugin%20%E4%BB%8E%20unix_socket%20%E5%88%87%E6%8D%A2%E4%B8%BA%20mysql_native_password%2C%20%E5%B9%B6%E4%B8%94%E7%BB%99%E7%94%A8%E6%88%B7%E8%AE%BE%E7%BD%AE%E5%AF%86%E7%A0%81%E3%80%82">修改 MariaDB 10.3 使用用户名和密码登陆 - 大伟哥博客</a></p>
</li>
</ul>
<h2 id="3-如果openstack-nova-compute无法启动"><a href="#3-如果openstack-nova-compute无法启动" class="headerlink" title="3. 如果openstack-nova-compute无法启动"></a>3. 如果openstack-nova-compute无法启动</h2><ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_62593237/article/details/124606290">解决openstack-nova-compute.service无法启动问题_job for openstack-nova-compute.service failed beca-CSDN博客</a></li>
</ul>
<h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><ol>
<li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/zz_aiytag/article/details/104390440">centos7.4安装部署openstack（rocky）_openstack liberty的仓库指定的baseurl-CSDN博客</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_28513801/article/details/90269044">解决搭建官方openstack时遇到的服务器报错Internal Server Error 返回状态500The server encountered an internal error_internal server error the server encountered an in-CSDN博客</a></p>
</li>
</ol>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="category-chain-item">服务器</a>
  
  
    <span>></span>
    
  <a href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/%E4%BA%91%E8%AE%A1%E7%AE%97/" class="category-chain-item">云计算</a>
  
  

  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Linux/" class="print-no-link">#Linux</a>
      
        <a href="/tags/OpenStack/" class="print-no-link">#OpenStack</a>
      
    </div>
  
</div>


               
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Openstack完全分布式手动搭建(Rocky版)</div>
      <div>https://smile-smith.github.io/2024/12/19/Openstack完全分布式手动搭建/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>smile smith</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年12月19日</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>更新于</div>
          <div>2024年12月19日</div>
        </div>
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
                  <span class="hint--top hint--rounded" aria-label="NC - 非商业性使用">
                    <i class="iconfont icon-cc-nc"></i>
                  </span>
                </a>
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
                  <span class="hint--top hint--rounded" aria-label="SA - 相同方式共享">
                    <i class="iconfont icon-cc-sa"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/12/12/%E6%90%AD%E5%BB%BAZeroTier%E7%9A%84Moon%E8%8A%82%E7%82%B9/" title="搭建ZeroTier的Moon节点">
                        <span class="hidden-mobile">搭建ZeroTier的Moon节点</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      var light = 'github-light';
      var dark = 'github-dark';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'smile-smith/commutt');
      s.setAttribute('issue-term', 'pathname');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  



  <script>
  Fluid.utils.createScript('https://lib.baomitu.com/mermaid/8.14.0/mermaid.min.js', function() {
    mermaid.initialize({"theme":"default"});

    Fluid.utils.listenDOMLoaded(function() {
      Fluid.events.registerRefreshCallback(function() {
        if ('mermaid' in window) {
          mermaid.init();
        }
      });
    });
  });
</script>






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div>
<span id="timeDate">正在载入天数...</span>
<span id="times">载入时分秒...</span>
<script>
 var now = new Date();
function createtime(){
   var grt= new Date("10/16/2020 00:00:00");//此处修改你的建站时间或者网站上线时间
   now.setTime(now.getTime()+250);
   days = (now - grt ) / 1000 / 60 / 60 / 24;
   dnum = Math.floor(days);
   hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum);
   hnum = Math.floor(hours);
   if(String(hnum).length ==1 ){
        hnum = "0" + hnum;
   }
   minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); 
   mnum = Math.floor(minutes);
   if(String(mnum).length ==1 ){
                mnum = "0" + mnum;
   }
   seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
   snum = Math.round(seconds);
   if(String(snum).length ==1 ){
                snum = "0" + snum;
   }
   document.getElementById("timeDate").innerHTML = "🚀本站已安全运行"+dnum+" 天 "; 
   document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒🚀"; 
} //此处自定义显示内容 
setInterval("createtime()",250);
</script>
</div>
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
